// @bun
var O2=Object.create;var{getPrototypeOf:C2,defineProperty:g1,getOwnPropertyNames:S2}=Object;var L2=Object.prototype.hasOwnProperty;var w1=($,W,X)=>{X=$!=null?O2(C2($)):{};const Z=W||!$||!$.__esModule?g1(X,"default",{value:$,enumerable:!0}):X;for(let j of S2($))if(!L2.call(Z,j))g1(Z,j,{get:()=>$[j],enumerable:!0});return Z};var q2=($,W)=>()=>(W||$((W={exports:{}}).exports,W),W.exports);var o0=q2((X8,o1)=>{function B3($){var W=$.indexOf("%");if(W===-1)return $;var X=$.length,Z="",j=0,J=0,Q=W,Y=r1;while(W>-1&&W<X){var U=a1($[W+1],4),B=a1($[W+2],0),K=U|B,w=N1[K];if(Y=N1[256+Y+w],J=J<<6|K&N1[364+w],Y===r1)Z+=$.slice(j,Q),Z+=J<=65535?String.fromCharCode(J):String.fromCharCode(55232+(J>>10),56320+(J&1023)),J=0,j=W+3,W=Q=$.indexOf("%",j);else if(Y===Y3)return null;else{if(W+=3,W<X&&$.charCodeAt(W)===37)continue;return null}}return Z+$.slice(j)}function a1($,W){var X=U3[$];return X===void 0?255:X<<W}var r1=12,Y3=0,N1=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,4,4,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,6,7,7,7,7,7,7,7,7,7,7,7,7,8,7,7,10,9,9,9,11,4,4,4,4,4,4,4,4,4,4,4,0,0,0,0,0,0,0,0,0,0,0,0,12,0,0,0,0,24,36,48,60,72,84,96,0,12,12,12,0,0,0,0,0,0,0,0,0,0,0,24,0,0,0,0,0,0,0,0,0,24,24,24,0,0,0,0,0,0,0,0,0,24,24,0,0,0,0,0,0,0,0,0,0,48,48,48,0,0,0,0,0,0,0,0,0,0,48,48,0,0,0,0,0,0,0,0,0,48,0,0,0,0,0,0,0,0,0,0,127,63,63,63,0,31,15,15,15,7,7,7],U3={"0":0,"1":1,"2":2,"3":3,"4":4,"5":5,"6":6,"7":7,"8":8,"9":9,a:10,A:10,b:11,B:11,c:12,C:12,d:13,D:13,e:14,E:14,f:15,F:15};o1.exports=B3});var T0=($,W)=>{const X=W?.length?{}:null;if(X)for(let Z of W)X[Z.part.charCodeAt(0)]=Z;return{part:$,store:null,inert:X,params:null,wildcardStore:null}},f1=($,W)=>({...$,part:W}),y1=($)=>({name:$,store:null,inert:null});class M0{root={};history=[];static regex={static:/:.+?(?=\/|$)/,params:/:.+?(?=\/|$)/g,optionalParams:/:.+?\?(?=\/|$)/g};add($,W,X,{ignoreError:Z=!1,ignoreHistory:j=!1}={}){if(typeof W!=="string")throw new TypeError("Route path must be a string");if(W==="")W="/";else if(W[0]!=="/")W=`/${W}`;const J=W[W.length-1]==="*",Q=W.match(M0.regex.optionalParams);if(Q){const w=W.replaceAll("?","");this.add($,w,X,{ignoreError:Z});for(let F=0;F<Q.length;F++){let G=W.replace("/"+Q[F],"");this.add($,G,X,{ignoreError:!0})}return X}if(Q)W=W.replaceAll("?","");if(this.history.find(([w,F,G])=>w===$&&F===W))return X;if(J||Q&&W.charCodeAt(W.length-1)===63)W=W.slice(0,-1);if(!j)this.history.push([$,W,X]);const Y=W.split(M0.regex.static),U=W.match(M0.regex.params)||[];if(Y[Y.length-1]==="")Y.pop();let B;if(!this.root[$])B=this.root[$]=T0("/");else B=this.root[$];let K=0;for(let w=0;w<Y.length;++w){let F=Y[w];if(w>0){const G=U[K++].slice(1);if(B.params===null)B.params=y1(G);else if(B.params.name!==G)if(Z)return X;else throw new Error(`Cannot create route "${W}" with parameter "${G}" because a route already exists with a different parameter name ("${B.params.name}") in the same location`);const M=B.params;if(M.inert===null){B=M.inert=T0(F);continue}B=M.inert}for(let G=0;;){if(G===F.length){if(G<B.part.length){const M=f1(B,B.part.slice(G));Object.assign(B,T0(F,[M]))}break}if(G===B.part.length){if(B.inert===null)B.inert={};const M=B.inert[F.charCodeAt(G)];if(M){B=M,F=F.slice(G),G=0;continue}const D=T0(F.slice(G));B.inert[F.charCodeAt(G)]=D,B=D;break}if(F[G]!==B.part[G]){const M=f1(B,B.part.slice(G)),D=T0(F.slice(G));Object.assign(B,T0(B.part.slice(0,G),[M,D])),B=D;break}++G}}if(K<U.length){const w=U[K].slice(1);if(B.params===null)B.params=y1(w);else if(B.params.name!==w)if(Z)return X;else throw new Error(`Cannot create route "${W}" with parameter "${w}" because a route already exists with a different parameter name ("${B.params.name}") in the same location`);if(B.params.store===null)B.params.store=X;return B.params.store}if(J){if(B.wildcardStore===null)B.wildcardStore=X;return B.wildcardStore}if(B.store===null)B.store=X;return B.store}find($,W){const X=this.root[$];if(!X)return null;return _1(W,W.length,X,0)}}var _1=($,W,X,Z)=>{const j=X.part,J=j.length,Q=Z+J;if(J>1){if(Q>W)return null;if(J<15){for(let Y=1,U=Z+1;Y<J;++Y,++U)if(j.charCodeAt(Y)!==$.charCodeAt(U))return null}else if($.slice(Z,Q)!==j)return null}if(Q===W){if(X.store!==null)return{store:X.store,params:{}};if(X.wildcardStore!==null)return{store:X.wildcardStore,params:{"*":""}};return null}if(X.inert!==null){const Y=X.inert[$.charCodeAt(Q)];if(Y!==void 0){const U=_1($,W,Y,Q);if(U!==null)return U}}if(X.params!==null){const{store:Y,name:U,inert:B}=X.params,K=$.indexOf("/",Q);if(K!==Q){if(K===-1||K>=W){if(Y!==null){const w={};return w[U]=$.substring(Q,W),{store:Y,params:w}}}else if(B!==null){const w=_1($,W,B,K);if(w!==null)return w.params[U]=$.substring(Q,K),w}}}if(X.wildcardStore!==null)return{store:X.wildcardStore,params:{"*":$.substring(Q,W)}};return null};var H0=($)=>{const W=typeof $==="object"?$.fn.toString():typeof $==="string"?$.toString():$,X=W.indexOf(")");if(W.charCodeAt(X+2)===61&&W.charCodeAt(X+5)!==123)return!0;return W.includes("return")},T2=($)=>{if($.startsWith("async"))$=$.slice(5);$=$.trimStart();let W=-1;if($.charCodeAt(0)===40){if(W=$.indexOf("=>",$.indexOf(")")),W!==-1){let j=W;while(j>0)if($.charCodeAt(--j)===41)break;let J=$.slice(W+2);if(J.charCodeAt(0)===32)J=J.trimStart();return[$.slice(1,j),J,{isArrowReturn:J.charCodeAt(0)!==123}]}}if($.startsWith("function")){W=$.indexOf("(");const j=$.indexOf(")");return[$.slice(W+1,j),$.slice(j+2),{isArrowReturn:!1}]}const X=$.indexOf("(");if(X!==-1){const j=$.indexOf("\n",2),J=$.slice(0,j),Q=J.lastIndexOf(")")+1,Y=$.slice(j+1);return[J.slice(X,Q),"{"+Y,{isArrowReturn:!1}]}const Z=$.split("\n",2);return[Z[0],Z[1],{isArrowReturn:!1}]},H2=($)=>{const W=$.indexOf("{");if(W===-1)return[-1,0];let X=W+1,Z=1;for(;X<$.length;X++){const j=$.charCodeAt(X);if(j===123)Z++;else if(j===125)Z--;if(Z===0)break}if(Z!==0)return[0,$.length];return[W,X+1]},E2=($)=>{const W=$.lastIndexOf("}");if(W===-1)return[-1,0];let X=W-1,Z=1;for(;X>=0;X--){const j=$.charCodeAt(X);if(j===125)Z++;else if(j===123)Z--;if(Z===0)break}if(Z!==0)return[-1,0];return[X,W+1]},k1=($)=>{while(!0){const W=$.indexOf(":");if(W===-1)break;let X=$.indexOf(",",W);if(X===-1)X=$.indexOf("}",W)-1;if(X===-2)X=$.length;$=$.slice(0,W)+$.slice(X)}return $},v1=($)=>{let W=!1;if($.charCodeAt(0)===40)$=$.slice(1,-1);if($.charCodeAt(0)===123)W=!0,$=$.slice(1,-1);$=$.replace(/( |\t|\n)/g,"").trim();let X=[];while(!0){let[j,J]=H2($);if(j===-1)break;if(X.push($.slice(0,j-1)),$.charCodeAt(J)===44)J++;$=$.slice(J)}if($=k1($),$)X=X.concat($.split(","));const Z=[];for(let j of X){if(j.indexOf(",")===-1){Z.push(j);continue}for(let J of j.split(","))Z.push(J.trim())}return X=Z,{hasParenthesis:W,parameters:X}},R2=($,W)=>{const{parameters:X,hasParenthesis:Z}=v1($);if(!W.query&&X.includes("query"))W.query=!0;if(!W.headers&&X.includes("headers"))W.headers=!0;if(!W.body&&X.includes("body"))W.body=!0;if(!W.cookie&&X.includes("cookie"))W.cookie=!0;if(!W.set&&X.includes("set"))W.set=!0;if(!W.server&&X.includes("server"))W.server=!0;if(Z)return`{ ${X.join(", ")} }`;return X.join(", ")},b2=($,W,X)=>{const Z=W.indexOf($+"\n",X),j=W.indexOf($+"\t",X),J=W.indexOf($+",",X),Q=W.indexOf($+";",X),Y=W.indexOf($+" ",X);return[Z,j,J,Q,Y].filter((U)=>U>0).sort((U,B)=>U-B)[0]||-1};var u1=($,W,X=0)=>{if(X>5)return[];const Z=[];let j=W;while(!0){let J=b2(" = "+$,j);if(J===-1){const U=j.indexOf(" = "+$);if(U+3+$.length!==j.length)break;J=U}const Q=j.slice(0,J);let Y=Q.slice(Q.lastIndexOf(" ")+1);if(Y==="}"){const[U,B]=E2(Q);Z.push(k1(j.slice(U,B))),j=j.slice(J+3+$.length);continue}while(Y.charCodeAt(0)===44)Y=Y.slice(1);while(Y.charCodeAt(0)===9)Y=Y.slice(1);if(!Y.includes("("))Z.push(Y);j=j.slice(J+3+$.length)}for(let J of Z){if(J.charCodeAt(0)===123)continue;const Q=u1(J,W);if(Q.length>0)Z.push(...Q)}return Z},x2=($)=>{if(!$)return;if($.charCodeAt(0)!==123)return $;if($=$.slice(2,-2),!$.includes(",")){if($.includes("..."))return $.slice($.indexOf("...")+3);return}const X=$.indexOf("...");if(X===-1)return;return $.slice(X+3).trimEnd()},g2=($,W,X)=>{const Z=(j,J)=>$.includes(J+"."+j)||$.includes(J+'["'+j+'"]')||$.includes(J+"['"+j+"']");for(let j of W){if(!j)continue;if(j.charCodeAt(0)===123){const J=v1(j).parameters;if(!X.query&&J.includes("query"))X.query=!0;if(!X.headers&&J.includes("headers"))X.headers=!0;if(!X.body&&J.includes("body"))X.body=!0;if(!X.cookie&&J.includes("cookie"))X.cookie=!0;if(!X.set&&J.includes("set"))X.set=!0;if(!X.query&&J.includes("server"))X.server=!0;continue}if(!X.query&&Z("query",j))X.query=!0;if($.includes("return "+j)||$.includes("return "+j+".query"))X.query=!0;if(!X.headers&&Z("headers",j))X.headers=!0;if(!X.body&&Z("body",j))X.body=!0;if(!X.cookie&&Z("cookie",j))X.cookie=!0;if(!X.set&&Z("set",j))X.set=!0;if(!X.server&&Z("server",j))X.server=!0;if(X.query&&X.headers&&X.body&&X.cookie&&X.set&&X.server)break}return W};var f2=($,W,X)=>{try{const Z=new RegExp(`(?:\\w)\\((?:.*)?${$}`,"gs");Z.test(W);const j=W.charCodeAt(Z.lastIndex);if(j===41||j===44)return X.query=!0,X.headers=!0,X.body=!0,X.cookie=!0,X.set=!0,X.server=!0,!0;return!1}catch(Z){return console.log("[Sucrose] warning: unexpected isContextPassToFunction error, you may continue development as usual but please report the following to maintainers:"),console.log("--- body ---"),console.log(W),console.log("--- context ---"),console.log($),!0}},s0=($,W={query:!1,headers:!1,body:!1,cookie:!1,set:!1,server:!1})=>{const X=[];if($.handler&&typeof $.handler==="function")X.push($.handler);if($.request?.length)X.push(...$.request);if($.beforeHandle?.length)X.push(...$.beforeHandle);if($.parse?.length)X.push(...$.parse);if($.error?.length)X.push(...$.error);if($.transform?.length)X.push(...$.transform);if($.afterHandle?.length)X.push(...$.afterHandle);if($.mapResponse?.length)X.push(...$.mapResponse);if($.afterResponse?.length)X.push(...$.afterResponse);for(let Z of X){if(!Z)continue;const j="fn"in Z?Z.fn:Z,[J,Q,{isArrowReturn:Y}]=T2(j.toString()),U=R2(J,W),B=x2(U);if(B){const K=u1(B,Q);if(K.splice(0,-1,B),!f2(B,Q,W))g2(Q,K,W);if(!W.query&&Q.includes("return "+B+".query"))W.query=!0}if(W.query&&W.headers&&W.body&&W.cookie&&W.set&&W.server)break}return W};import{Value as c0}from"@sinclair/typebox/value";import{Kind as R0,TransformKind as J2}from"@sinclair/typebox";import{Value as B0}from"@sinclair/typebox/value";import{TypeCompiler as Q2}from"@sinclair/typebox/compiler";import{TypeRegistry as i1}from"@sinclair/typebox";import{TypeSystem as E0}from"@sinclair/typebox/system";import{Type as k0,FormatRegistry as e}from"@sinclair/typebox";import{TypeCompiler as l1}from"@sinclair/typebox/compiler";import{Value as o}from"@sinclair/typebox/value";function y2($){return $%4===0&&($%100!==0||$%400===0)}function c1($){const W=k2.exec($);if(!W)return!1;const X=+W[1],Z=+W[2],j=+W[3];return Z>=1&&Z<=12&&j>=1&&j<=(Z===2&&y2(X)?29:v2[Z])}function F1($){return function W(X){const Z=u2.exec(X);if(!Z)return!1;const j=+Z[1],J=+Z[2],Q=+Z[3],Y=Z[4],U=Z[5]==="-"?-1:1,B=+(Z[6]||0),K=+(Z[7]||0);if(B>23||K>59||$&&!Y)return!1;if(j<=23&&J<=59&&Q<60)return!0;const w=J-K*U,F=j-B*U-(w<0?1:0);return(F===23||F===-1)&&(w===59||w===-1)&&Q<61}}function h1($){const W=F1($);return function X(Z){const j=Z.split(h2);return j.length===2&&c1(j[0])&&W(j[1])}}function c2($){return m2.test($)&&d2.test($)}function l2($){return m1.lastIndex=0,m1.test($)}function n2($){return Number.isInteger($)&&$<=i2&&$>=p2}function t2($){return Number.isInteger($)}function d1(){return!0}function r2($){if(s2.test($))return!1;try{return new RegExp($),!0}catch(W){return!1}}var r0={date:c1,time:F1(!0),"date-time":h1(!0),"iso-time":F1(!1),"iso-date-time":h1(!1),duration:/^P(?!$)((\d+Y)?(\d+M)?(\d+D)?(T(?=\d)(\d+H)?(\d+M)?(\d+S)?)?|(\d+W)?)$/,uri:c2,"uri-reference":/^(?:[a-z][a-z0-9+\-.]*:)?(?:\/?\/(?:(?:[a-z0-9\-._~!$&'()*+,;=:]|%[0-9a-f]{2})*@)?(?:\[(?:(?:(?:(?:[0-9a-f]{1,4}:){6}|::(?:[0-9a-f]{1,4}:){5}|(?:[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){4}|(?:(?:[0-9a-f]{1,4}:){0,1}[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){3}|(?:(?:[0-9a-f]{1,4}:){0,2}[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){2}|(?:(?:[0-9a-f]{1,4}:){0,3}[0-9a-f]{1,4})?::[0-9a-f]{1,4}:|(?:(?:[0-9a-f]{1,4}:){0,4}[0-9a-f]{1,4})?::)(?:[0-9a-f]{1,4}:[0-9a-f]{1,4}|(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?))|(?:(?:[0-9a-f]{1,4}:){0,5}[0-9a-f]{1,4})?::[0-9a-f]{1,4}|(?:(?:[0-9a-f]{1,4}:){0,6}[0-9a-f]{1,4})?::)|[Vv][0-9a-f]+\.[a-z0-9\-._~!$&'()*+,;=:]+)\]|(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?)|(?:[a-z0-9\-._~!$&'"()*+,;=]|%[0-9a-f]{2})*)(?::\d*)?(?:\/(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})*)*|\/(?:(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})+(?:\/(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})*)*)?|(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})+(?:\/(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})*)*)?(?:\?(?:[a-z0-9\-._~!$&'"()*+,;=:@/?]|%[0-9a-f]{2})*)?(?:#(?:[a-z0-9\-._~!$&'"()*+,;=:@/?]|%[0-9a-f]{2})*)?$/i,"uri-template":/^(?:(?:[^\x00-\x20"'<>%\\^`{|}]|%[0-9a-f]{2})|\{[+#./;?&=,!@|]?(?:[a-z0-9_]|%[0-9a-f]{2})+(?::[1-9][0-9]{0,3}|\*)?(?:,(?:[a-z0-9_]|%[0-9a-f]{2})+(?::[1-9][0-9]{0,3}|\*)?)*\})*$/i,url:/^(?:https?|ftp):\/\/(?:\S+(?::\S*)?@)?(?:(?!(?:10|127)(?:\.\d{1,3}){3})(?!(?:169\.254|192\.168)(?:\.\d{1,3}){2})(?!172\.(?:1[6-9]|2\d|3[0-1])(?:\.\d{1,3}){2})(?:[1-9]\d?|1\d\d|2[01]\d|22[0-3])(?:\.(?:1?\d{1,2}|2[0-4]\d|25[0-5])){2}(?:\.(?:[1-9]\d?|1\d\d|2[0-4]\d|25[0-4]))|(?:(?:[a-z0-9\u{00a1}-\u{ffff}]+-)*[a-z0-9\u{00a1}-\u{ffff}]+)(?:\.(?:[a-z0-9\u{00a1}-\u{ffff}]+-)*[a-z0-9\u{00a1}-\u{ffff}]+)*(?:\.(?:[a-z\u{00a1}-\u{ffff}]{2,})))(?::\d{2,5})?(?:\/[^\s]*)?$/iu,email:/^[a-z0-9!#$%&'*+/=?^_`{|}~-]+(?:\.[a-z0-9!#$%&'*+/=?^_`{|}~-]+)*@(?:[a-z0-9](?:[a-z0-9-]*[a-z0-9])?\.)+[a-z0-9](?:[a-z0-9-]*[a-z0-9])?$/i,hostname:/^(?=.{1,253}\.?$)[a-z0-9](?:[a-z0-9-]{0,61}[a-z0-9])?(?:\.[a-z0-9](?:[-0-9a-z]{0,61}[0-9a-z])?)*\.?$/i,ipv4:/^(?:(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)\.){3}(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)$/,ipv6:/^((([0-9a-f]{1,4}:){7}([0-9a-f]{1,4}|:))|(([0-9a-f]{1,4}:){6}(:[0-9a-f]{1,4}|((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(([0-9a-f]{1,4}:){5}(((:[0-9a-f]{1,4}){1,2})|:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(([0-9a-f]{1,4}:){4}(((:[0-9a-f]{1,4}){1,3})|((:[0-9a-f]{1,4})?:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9a-f]{1,4}:){3}(((:[0-9a-f]{1,4}){1,4})|((:[0-9a-f]{1,4}){0,2}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9a-f]{1,4}:){2}(((:[0-9a-f]{1,4}){1,5})|((:[0-9a-f]{1,4}){0,3}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9a-f]{1,4}:){1}(((:[0-9a-f]{1,4}){1,6})|((:[0-9a-f]{1,4}){0,4}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(:(((:[0-9a-f]{1,4}){1,7})|((:[0-9a-f]{1,4}){0,5}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:)))$/i,regex:r2,uuid:/^(?:urn:uuid:)?[0-9a-f]{8}-(?:[0-9a-f]{4}-){3}[0-9a-f]{12}$/i,"json-pointer":/^(?:\/(?:[^~/]|~0|~1)*)*$/,"json-pointer-uri-fragment":/^#(?:\/(?:[a-z0-9_\-.!$&'()*+,;:=@]|%[0-9a-f]{2}|~0|~1)*)*$/i,"relative-json-pointer":/^(?:0|[1-9][0-9]*)(?:#|(?:\/(?:[^~/]|~0|~1)*)*)$/,byte:l2,int32:{type:"number",validate:n2},int64:{type:"number",validate:t2},float:{type:"number",validate:d1},double:{type:"number",validate:d1},password:!0,binary:!0},k2=/^(\d\d\d\d)-(\d\d)-(\d\d)$/,v2=[0,31,28,31,30,31,30,31,31,30,31,30,31],u2=/^(\d\d):(\d\d):(\d\d(?:\.\d+)?)(z|([+-])(\d\d)(?::?(\d\d))?)?$/i,h2=/t|\s/i,m2=/\/|:/,d2=/^(?:[a-z][a-z0-9+\-.]*:)(?:\/?\/(?:(?:[a-z0-9\-._~!$&'()*+,;=:]|%[0-9a-f]{2})*@)?(?:\[(?:(?:(?:(?:[0-9a-f]{1,4}:){6}|::(?:[0-9a-f]{1,4}:){5}|(?:[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){4}|(?:(?:[0-9a-f]{1,4}:){0,1}[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){3}|(?:(?:[0-9a-f]{1,4}:){0,2}[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){2}|(?:(?:[0-9a-f]{1,4}:){0,3}[0-9a-f]{1,4})?::[0-9a-f]{1,4}:|(?:(?:[0-9a-f]{1,4}:){0,4}[0-9a-f]{1,4})?::)(?:[0-9a-f]{1,4}:[0-9a-f]{1,4}|(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?))|(?:(?:[0-9a-f]{1,4}:){0,5}[0-9a-f]{1,4})?::[0-9a-f]{1,4}|(?:(?:[0-9a-f]{1,4}:){0,6}[0-9a-f]{1,4})?::)|[Vv][0-9a-f]+\.[a-z0-9\-._~!$&'()*+,;=:]+)\]|(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?)|(?:[a-z0-9\-._~!$&'()*+,;=]|%[0-9a-f]{2})*)(?::\d*)?(?:\/(?:[a-z0-9\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})*)*|\/(?:(?:[a-z0-9\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})+(?:\/(?:[a-z0-9\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})*)*)?|(?:[a-z0-9\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})+(?:\/(?:[a-z0-9\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})*)*)(?:\?(?:[a-z0-9\-._~!$&'()*+,;=:@/?]|%[0-9a-f]{2})*)?(?:#(?:[a-z0-9\-._~!$&'()*+,;=:@/?]|%[0-9a-f]{2})*)?$/i,m1=/^(?:[A-Za-z0-9+/]{4})*(?:[A-Za-z0-9+/]{2}==|[A-Za-z0-9+/]{3}=)?$/gm,p2=-2147483648,i2=2147483647,s2=/[^\\]\\Z/;import{TypeSystemPolicy as t3,TypeSystem as s3,TypeSystemDuplicateFormat as r3,TypeSystemDuplicateTypeKind as a3}from"@sinclair/typebox/system";import{TypeCompiler as e3,TypeCheck as $8}from"@sinclair/typebox/compiler";var n1=/(\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d:[0-5]\d\.\d+([+-][0-2]\d:[0-5]\d|Z))|(\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d:[0-5]\d([+-][0-2]\d:[0-5]\d|Z))|(\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d([+-][0-2]\d:[0-5]\d|Z))/,t1=/(?:Sun|Mon|Tue|Wed|Thu|Fri|Sat)\s(?:Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec)\s\d{2}\s\d{4}\s\d{2}:\d{2}:\d{2}\sGMT(?:\+|-)\d{4}\s\([^)]+\)/,s1=/^(?:(?:(?:(?:0?[1-9]|[12][0-9]|3[01])[/\s-](?:0?[1-9]|1[0-2])[/\s-](?:19|20)\d{2})|(?:(?:19|20)\d{2}[/\s-](?:0?[1-9]|1[0-2])[/\s-](?:0?[1-9]|[12][0-9]|3[01]))))(?:\s(?:1[012]|0?[1-9]):[0-5][0-9](?::[0-5][0-9])?(?:\s[AP]M)?)?$/,a2=r0.date,o2=r0["date-time"];if(!e.Has("date"))E0.Format("date",($)=>{const W=$.replace(/"/g,"");if(n1.test(W)||t1.test(W)||s1.test(W)||a2(W)){const X=new Date(W);if(!Number.isNaN(X.getTime()))return!0}return!1});if(!e.Has("date-time"))E0.Format("date-time",($)=>{const W=$.replace(/"/g,"");if(n1.test(W)||t1.test(W)||s1.test(W)||o2(W)){const X=new Date(W);if(!Number.isNaN(X.getTime()))return!0}return!1});Object.entries(r0).forEach(($)=>{const[W,X]=$;if(!e.Has(W)){if(X instanceof RegExp)E0.Format(W,(Z)=>X.test(Z));else if(typeof X==="function")E0.Format(W,X)}});var O=Object.assign({},k0),p1=($)=>{if(typeof $==="string")switch($.slice(-1)){case"k":return+$.slice(0,$.length-1)*1024;case"m":return+$.slice(0,$.length-1)*1048576;default:return+$}return $},M1=($,W)=>{if(!(W instanceof Blob))return!1;if($.minSize&&W.size<p1($.minSize))return!1;if($.maxSize&&W.size>p1($.maxSize))return!1;if($.extension)if(typeof $.extension==="string"){if(!W.type.startsWith($.extension))return!1}else{for(let X=0;X<$.extension.length;X++)if(W.type.startsWith($.extension[X]))return!0;return!1}return!0},e2=i1.Get("Files")??E0.Type("File",M1),$3=i1.Get("Files")??E0.Type("Files",($,W)=>{if(!Array.isArray(W))return M1($,W);if($.minItems&&W.length<$.minItems)return!1;if($.maxItems&&W.length>$.maxItems)return!1;for(let X=0;X<W.length;X++)if(!M1($,W[X]))return!1;return!0});if(!e.Has("numeric"))e.Set("numeric",($)=>!!$&&!isNaN(+$));if(!e.Has("boolean"))e.Set("boolean",($)=>$==="true"||$==="false");if(!e.Has("ObjectString"))e.Set("ObjectString",($)=>{let W=$.charCodeAt(0);if(W===9||W===10||W===32)W=$.trimStart().charCodeAt(0);if(W!==123&&W!==91)return!1;try{return JSON.parse($),!0}catch{return!1}});if(!e.Has("ArrayString"))e.Set("ArrayString",($)=>{let W=$.charCodeAt(0);if(W===9||W===10||W===32)W=$.trimStart().charCodeAt(0);if(W!==123&&W!==91)return!1;try{return JSON.parse($),!0}catch{return!1}});var Q0={Numeric:($)=>{const W=k0.Number($);return O.Transform(O.Union([O.String({format:"numeric",default:0}),O.Number($)],$)).Decode((X)=>{const Z=+X;if(isNaN(Z))return X;if($&&!o.Check(W,Z))throw new T("property",W,Z);return Z}).Encode((X)=>X)},Date:($)=>{const W=k0.Date($);return O.Transform(O.Union([k0.Date($),O.String({format:"date",default:new Date().toISOString()}),O.String({format:"date-time",default:new Date().toISOString()})],$)).Decode((X)=>{if(X instanceof Date)return X;const Z=new Date(X);if(!o.Check(W,Z))throw new T("property",W,Z);return Z}).Encode((X)=>{if(typeof X==="string")return new Date(X);return X})},BooleanString:($)=>{const W=k0.Boolean($);return O.Transform(O.Union([O.String({format:"boolean",default:!1}),O.Boolean($)],$)).Decode((X)=>{if(typeof X==="string")return X==="true";if($&&!o.Check(W,X))throw new T("property",W,X);return X}).Encode((X)=>X)},ObjectString:($,W)=>{const X=O.Object($,W),Z=JSON.stringify(o.Create(X));let j;try{j=l1.Compile(X)}catch{}return O.Transform(O.Union([O.String({format:"ObjectString",default:Z}),X])).Decode((J)=>{if(typeof J==="string"){if(J.charCodeAt(0)!==123)throw new T("property",X,J);try{J=JSON.parse(J)}catch{throw new T("property",X,J)}if(j){if(!j.Check(J))throw new T("property",X,J);return j.Decode(J)}if(!o.Check(X,J))throw new T("property",X,J);return o.Decode(X,J)}return J}).Encode((J)=>{if(typeof J==="string")try{J=JSON.parse(J)}catch{throw new T("property",X,J)}if(!o.Check(X,J))throw new T("property",X,J);return JSON.stringify(J)})},ArrayString:($={},W)=>{const X=O.Array($,W),Z=JSON.stringify(o.Create(X));let j;try{j=l1.Compile(X)}catch{}return O.Transform(O.Union([O.String({format:"ArrayString",default:Z}),X])).Decode((J)=>{if(typeof J==="string"){if(J.charCodeAt(0)!==91)throw new T("property",X,J);try{J=JSON.parse(J)}catch{throw new T("property",X,J)}if(j){if(!j.Check(J))throw new T("property",X,J);return j.Decode(J)}if(!o.Check(X,J))throw new T("property",X,J);return o.Decode(X,J)}return J}).Encode((J)=>{if(typeof J==="string")try{J=JSON.parse(J)}catch{throw new T("property",X,J)}if(!o.Check(X,J))throw new T("property",X,J);return JSON.stringify(J)})},File:e2,Files:($={})=>O.Transform($3($)).Decode((W)=>{if(Array.isArray(W))return W;return[W]}).Encode((W)=>W),Nullable:($)=>O.Union([$,O.Null()]),MaybeEmpty:($)=>O.Union([$,O.Null(),O.Undefined()]),Cookie:($,{domain:W,expires:X,httpOnly:Z,maxAge:j,path:J,priority:Q,sameSite:Y,secure:U,secrets:B,sign:K,...w}={})=>{const F=O.Object($,w);return F.config={domain:W,expires:X,httpOnly:Z,maxAge:j,path:J,priority:Q,sameSite:Y,secure:U,secrets:B,sign:K},F}};O.BooleanString=Q0.BooleanString;O.ObjectString=Q0.ObjectString;O.ArrayString=Q0.ArrayString;O.Numeric=Q0.Numeric;O.File=($={})=>Q0.File({default:"File",...$,extension:$?.type,type:"string",format:"binary"});O.Files=($={})=>Q0.Files({...$,elysiaMeta:"Files",default:"Files",extension:$?.type,type:"array",items:{...$,default:"Files",type:"string",format:"binary"}});O.Nullable=($)=>Q0.Nullable($);O.MaybeEmpty=Q0.MaybeEmpty;O.Cookie=Q0.Cookie;O.Date=Q0.Date;function X3($,W){if(typeof $!=="string")throw new TypeError("argument str must be a string");var X={},Z=W||{},j=Z.decode||J3,J=0;while(J<$.length){var Q=$.indexOf("=",J);if(Q===-1)break;var Y=$.indexOf(";",J);if(Y===-1)Y=$.length;else if(Y<Q){J=$.lastIndexOf(";",Q-1)+1;continue}var U=$.slice(J,Q).trim();if(X[U]===void 0){var B=$.slice(Q+1,Y).trim();if(B.charCodeAt(0)===34)B=B.slice(1,-1);X[U]=G3(B,j)}J=Y+1}return X}function Z3($,W,X){var Z=X||{},j=Z.encode||j3;if(typeof j!=="function")throw new TypeError("option encode is invalid");if(!a0.test($))throw new TypeError("argument name is invalid");var J=j(W);if(J&&!a0.test(J))throw new TypeError("argument val is invalid");var Q=$+"="+J;if(Z.maxAge!=null){var Y=Z.maxAge-0;if(isNaN(Y)||!isFinite(Y))throw new TypeError("option maxAge is invalid");Q+="; Max-Age="+Math.floor(Y)}if(Z.domain){if(!a0.test(Z.domain))throw new TypeError("option domain is invalid");Q+="; Domain="+Z.domain}if(Z.path){if(!a0.test(Z.path))throw new TypeError("option path is invalid");Q+="; Path="+Z.path}if(Z.expires){var U=Z.expires;if(!Q3(U)||isNaN(U.valueOf()))throw new TypeError("option expires is invalid");Q+="; Expires="+U.toUTCString()}if(Z.httpOnly)Q+="; HttpOnly";if(Z.secure)Q+="; Secure";if(Z.partitioned)Q+="; Partitioned";if(Z.priority){var B=typeof Z.priority==="string"?Z.priority.toLowerCase():Z.priority;switch(B){case"low":Q+="; Priority=Low";break;case"medium":Q+="; Priority=Medium";break;case"high":Q+="; Priority=High";break;default:throw new TypeError("option priority is invalid")}}if(Z.sameSite){var K=typeof Z.sameSite==="string"?Z.sameSite.toLowerCase():Z.sameSite;switch(K){case!0:Q+="; SameSite=Strict";break;case"lax":Q+="; SameSite=Lax";break;case"strict":Q+="; SameSite=Strict";break;case"none":Q+="; SameSite=None";break;default:throw new TypeError("option sameSite is invalid")}}return Q}function J3($){return $.indexOf("%")!==-1?decodeURIComponent($):$}function j3($){return encodeURIComponent($)}function Q3($){return W3.call($)==="[object Date]"||$ instanceof Date}function G3($,W){try{return W($)}catch(X){return $}}/*!
 * cookie
 * Copyright(c) 2012-2014 Roman Shtylman
 * Copyright(c) 2015 Douglas Christopher Wilson
 * MIT Licensed
 */var z1=X3,D1=Z3;var W3=Object.prototype.toString,a0=/^[\u0009\u0020-\u007e\u0080-\u00ff]+$/;var $2=w1(o0(),1);class K0{$;W;X;constructor($,W,X={}){this.name=$;this.jar=W;this.initial=X}get cookie(){if(!(this.name in this.jar))return this.initial;return this.jar[this.name]}set cookie($){if(!(this.name in this.jar))this.jar[this.name]=this.initial;this.jar[this.name]=$}get value(){return this.cookie.value}set value($){if(!(this.name in this.jar))this.jar[this.name]=this.initial;this.jar[this.name].value=$}get expires(){return this.cookie.expires}set expires($){this.cookie.expires=$}get maxAge(){return this.cookie.maxAge}set maxAge($){this.cookie.maxAge=$}get domain(){return this.cookie.domain}set domain($){this.cookie.domain=$}get path(){return this.cookie.path}set path($){this.cookie.path=$}get secure(){return this.cookie.secure}set secure($){this.cookie.secure=$}get httpOnly(){return this.cookie.httpOnly}set httpOnly($){this.cookie.httpOnly=$}get sameSite(){return this.cookie.sameSite}set sameSite($){this.cookie.sameSite=$}get priority(){return this.cookie.priority}set priority($){this.cookie.priority=$}get partitioned(){return this.cookie.partitioned}set partitioned($){this.cookie.partitioned=$}get secrets(){return this.cookie.secrets}set secrets($){this.cookie.secrets=$}update($){return this.cookie=Object.assign(this.cookie,typeof $==="function"?$(this.cookie):$),this}set($){return this.cookie=Object.assign({...this.initial,value:this.value},typeof $==="function"?$(this.cookie):$),this}remove(){if(this.value===void 0)return;return this.set({expires:new Date(0),maxAge:0,value:""}),this}toString(){return typeof this.value==="object"?JSON.stringify(this.value):this.value?.toString()??""}}var e1=($,W,X)=>{if(!$.cookie)$.cookie={};return new Proxy(W,{get(Z,j){if(j in W)return new K0(j,$.cookie,Object.assign({},X??{},W[j]));return new K0(j,$.cookie,Object.assign({},X))}})},e0=async($,W,{secrets:X,sign:Z,...j}={})=>{if(!W)return e1($,{},j);const J=typeof X==="string";if(Z&&Z!==!0&&!Array.isArray(Z))Z=[Z];const Q={},Y=z1(W);for(let[U,B]of Object.entries(Y)){let K=$2.default(B);if(Z===!0||Z?.includes(U)){if(!X)throw new Error("No secret is provided to cookie plugin");if(J){const w=await P1(K,X);if(w===!1)throw new v0(U);K=w}else{let w=!0;for(let F=0;F<X.length;F++){const G=await P1(K,X[F]);if(G!==!1){w=!0,K=G;break}}if(!w)throw new v0(U)}}Q[U]={value:K}}return e1($,Q,j)};async function*h0($){const W=$.body;if(!W)return;const X=W.getReader(),Z=new TextDecoder;try{while(!0){const{done:j,value:J}=await X.read();if(j)break;yield Z.decode(J)}}finally{X.releaseLock()}}var W2="toJSON"in new Headers,p=($)=>{if(!$)return!1;for(let W in $)return!0;return!1},u0=($,W)=>{const X=$.size;if(!W&&X||X&&W&&W.status!==206&&W.status!==304&&W.status!==412&&W.status!==416){if(W){if(W.headers instanceof Headers){if(W2)W.headers=W.headers.toJSON();else for(let[Z,j]of W.headers.entries())if(Z in W.headers)W.headers[Z]=j}return new Response($,{status:W.status,headers:Object.assign({"accept-ranges":"bytes","content-range":`bytes 0-${X-1}/${X}`},W.headers)})}return new Response($,{headers:{"accept-ranges":"bytes","content-range":`bytes 0-${X-1}/${X}`}})}return new Response($)},X2=($,W)=>{if(!$)return $;$.delete("set-cookie");for(let X=0;X<W.length;X++){const Z=W[X].indexOf("=");$.append("set-cookie",`${W[X].slice(0,Z)}=${W[X].slice(Z+1)||""}`)}return $},Z2=($)=>{if(!$||!p($))return;const W=[];for(let[X,Z]of Object.entries($)){if(!X||!Z)continue;const j=Z.value;if(j===void 0||j===null)continue;W.push(D1(X,typeof j==="object"?JSON.stringify(j):j+"",Z))}if(W.length===0)return;if(W.length===1)return W[0];return W},G0=async($,W,X)=>{let Z=$.next();if(Z instanceof Promise)Z=await Z;if(Z.done){if(W)return f(Z.value,W,X);return $0(Z.value,X)}return new Response(new ReadableStream({async start(j){let J=!1;if(X?.signal.addEventListener("abort",()=>{J=!0;try{j.close()}catch{}}),Z.value!==void 0&&Z.value!==null)if(typeof Z.value==="object")try{j.enqueue(Buffer.from(JSON.stringify(Z.value)))}catch{j.enqueue(Buffer.from(Z.value.toString()))}else j.enqueue(Buffer.from(Z.value.toString()));for await(let Q of $){if(J)break;if(Q===void 0||Q===null)continue;if(typeof Q==="object")try{j.enqueue(Buffer.from(JSON.stringify(Q)))}catch{j.enqueue(Buffer.from(Q.toString()))}else j.enqueue(Buffer.from(Q.toString()));await new Promise((Y)=>setTimeout(()=>Y(),0))}try{j.close()}catch{}}}),{...W,headers:{"transfer-encoding":"chunked","content-type":"text/event-stream; charset=utf-8",...W?.headers}})},f=($,W,X)=>{if(p(W.headers)||W.status!==200||W.redirect||W.cookie){if(typeof W.status==="string")W.status=w0[W.status];if(W.redirect){if(W.headers.Location=W.redirect,!W.status||W.status<300||W.status>=400)W.status=302}if(W.cookie&&p(W.cookie)){const Z=Z2(W.cookie);if(Z)W.headers["set-cookie"]=Z}if(W.headers["set-cookie"]&&Array.isArray(W.headers["set-cookie"]))W.headers=X2(new Headers(W.headers),W.headers["set-cookie"]);switch($?.constructor?.name){case"String":return new Response($,W);case"Blob":return u0($,W);case"Array":return Response.json($,W);case"Object":const Z=$[d];if(Z)return W.status=Z,f($.response,W,X);for(let J in Object.values($))switch(J?.constructor?.name){case"Blob":case"File":case"ArrayBuffer":case"FileRef":return new Response(N0($));default:break}return Response.json($,W);case"ReadableStream":if(!W.headers["content-type"]?.startsWith("text/event-stream"))W.headers["content-type"]="text/event-stream; charset=utf-8";return X?.signal.addEventListener("abort",{handleEvent(){if(!X?.signal.aborted)$.cancel(X)}},{once:!0}),new Response($,W);case void 0:if(!$)return new Response("",W);return Response.json($,W);case"Response":let j=!1;if(W.headers instanceof Headers)for(let J of W.headers.keys())if(J==="set-cookie"){if(j)continue;j=!0;for(let Q of W.headers.getSetCookie())$.headers.append("set-cookie",Q)}else $.headers.append(J,W.headers?.get(J)??"");else for(let J in W.headers)$.headers.append(J,W.headers[J]);if($.status!==W.status)W.status=$.status;if($.headers.get("transfer-encoding")==="chunked")return G0(h0($),W,X);return $;case"Error":return Y0($,W);case"Promise":return $.then((J)=>f(J,W));case"Function":return f($(),W);case"Number":case"Boolean":return new Response($.toString(),W);case"Cookie":if($ instanceof K0)return new Response($.value,W);return new Response($?.toString(),W);case"FormData":return new Response($,W);default:if($ instanceof Response){let J=!1;if(W.headers instanceof Headers)for(let Q of W.headers.keys())if(Q==="set-cookie"){if(J)continue;J=!0;for(let Y of W.headers.getSetCookie())$.headers.append("set-cookie",Y)}else $.headers.append(Q,W.headers?.get(Q)??"");else for(let Q in W.headers)$.headers.append(Q,W.headers[Q]);if(W2)W.headers=$.headers.toJSON();else for(let[Q,Y]of $.headers.entries())if(Q in W.headers)W.headers[Q]=Y;return $}if($ instanceof Promise)return $.then((J)=>f(J,W));if($ instanceof Error)return Y0($,W);if(typeof $?.next==="function")return G0($,W,X);if("toResponse"in $)return f($.toResponse(),W);if("charCodeAt"in $){const J=$.charCodeAt(0);if(J===123||J===91){if(!W.headers["Content-Type"])W.headers["Content-Type"]="application/json";return new Response(JSON.stringify($),W)}}return new Response($,W)}}else switch($?.constructor?.name){case"String":return new Response($);case"Blob":return u0($,W);case"Array":return Response.json($);case"Object":const Z=$[d];if(Z)return W.status=Z,f($.response,W,X);for(let j in Object.values($))switch(j?.constructor?.name){case"Blob":case"File":case"ArrayBuffer":case"FileRef":return new Response(N0($),W);default:break}return Response.json($,W);case"ReadableStream":return X?.signal.addEventListener("abort",{handleEvent(){if(!X?.signal.aborted)$.cancel(X)}},{once:!0}),new Response($,{headers:{"Content-Type":"text/event-stream; charset=utf-8"}});case void 0:if(!$)return new Response("");return new Response(JSON.stringify($),{headers:{"content-type":"application/json"}});case"Response":if($.headers.get("transfer-encoding")==="chunked")return G0(h0($),W,X);return $;case"Error":return Y0($,W);case"Promise":return $.then((j)=>{const J=$0(j,X);if(J!==void 0)return J;return new Response("")});case"Function":return $0($(),X);case"Number":case"Boolean":return new Response($.toString());case"Cookie":if($ instanceof K0)return new Response($.value,W);return new Response($?.toString(),W);case"FormData":return new Response($,W);default:if($ instanceof Response)return new Response($.body,{headers:{"Content-Type":"application/json"}});if($ instanceof Promise)return $.then((j)=>f(j,W));if($ instanceof Error)return Y0($,W);if(typeof $?.next==="function")return G0($,W,X);if("toResponse"in $)return f($.toResponse(),W);if("charCodeAt"in $){const j=$.charCodeAt(0);if(j===123||j===91){if(!W.headers["Content-Type"])W.headers["Content-Type"]="application/json";return new Response(JSON.stringify($),W)}}return new Response($)}},y=($,W,X)=>{if($===void 0||$===null)return;if(p(W.headers)||W.status!==200||W.redirect||W.cookie){if(typeof W.status==="string")W.status=w0[W.status];if(W.redirect){if(W.headers.Location=W.redirect,!W.status||W.status<300||W.status>=400)W.status=302}if(W.cookie&&p(W.cookie)){const Z=Z2(W.cookie);if(Z)W.headers["set-cookie"]=Z}if(W.headers["set-cookie"]&&Array.isArray(W.headers["set-cookie"]))W.headers=X2(new Headers(W.headers),W.headers["set-cookie"]);switch($?.constructor?.name){case"String":return new Response($,W);case"Blob":return u0($,W);case"Array":return Response.json($,W);case"Object":const Z=$[d];if(Z)return W.status=Z,y($.response,W,X);for(let J in Object.values($))switch(J?.constructor?.name){case"Blob":case"File":case"ArrayBuffer":case"FileRef":return new Response(N0($),W);default:break}return Response.json($,W);case"ReadableStream":if(!W.headers["content-type"]?.startsWith("text/event-stream"))W.headers["content-type"]="text/event-stream; charset=utf-8";return X?.signal.addEventListener("abort",{handleEvent(){if(!X?.signal.aborted)$.cancel(X)}},{once:!0}),new Response($,W);case void 0:if(!$)return;return Response.json($,W);case"Response":let j=!1;if(W.headers instanceof Headers)for(let J of W.headers.keys())if(J==="set-cookie"){if(j)continue;j=!0;for(let Q of W.headers.getSetCookie())$.headers.append("set-cookie",Q)}else $.headers.append(J,W.headers?.get(J)??"");else for(let J in W.headers)$.headers.append(J,W.headers[J]);if($.status!==W.status)W.status=$.status;if($.headers.get("transfer-encoding")==="chunked")return G0(h0($),W,X);return $;case"Promise":return $.then((J)=>{const Q=y(J,W);if(Q!==void 0)return Q});case"Error":return Y0($,W);case"Function":return y($(),W);case"Number":case"Boolean":return new Response($.toString(),W);case"FormData":return new Response($);case"Cookie":if($ instanceof K0)return new Response($.value,W);return new Response($?.toString(),W);default:if($ instanceof Response){let J=!1;if(W.headers instanceof Headers)for(let Q of W.headers.keys())if(Q==="set-cookie"){if(J)continue;J=!0;for(let Y of W.headers.getSetCookie())$.headers.append("set-cookie",Y)}else $.headers.append(Q,W.headers?.get(Q)??"");else for(let Q in W.headers)$.headers.append(Q,W.headers[Q]);if($.status!==W.status)W.status=$.status;return $}if($ instanceof Promise)return $.then((J)=>y(J,W));if($ instanceof Error)return Y0($,W);if(typeof $?.next==="function")return G0($,W,X);if("toResponse"in $)return y($.toResponse(),W);if("charCodeAt"in $){const J=$.charCodeAt(0);if(J===123||J===91){if(!W.headers["Content-Type"])W.headers["Content-Type"]="application/json";return new Response(JSON.stringify($),W)}}return new Response($,W)}}else switch($?.constructor?.name){case"String":return new Response($);case"Blob":return u0($,W);case"Array":return Response.json($);case"Object":const Z=$[d];if(Z)return W.status=Z,y($.response,W,X);for(let j in Object.values($))switch(j?.constructor?.name){case"Blob":case"File":case"ArrayBuffer":case"FileRef":return new Response(N0($),W);default:break}return Response.json($,W);case"ReadableStream":return X?.signal.addEventListener("abort",{handleEvent(){if(!X?.signal.aborted)$.cancel(X)}},{once:!0}),new Response($,{headers:{"Content-Type":"text/event-stream; charset=utf-8"}});case void 0:if(!$)return new Response("");return new Response(JSON.stringify($),{headers:{"content-type":"application/json"}});case"Response":if($.headers.get("transfer-encoding")==="chunked")return G0(h0($));return $;case"Promise":return $.then((j)=>{const J=y(j,W);if(J!==void 0)return J});case"Error":return Y0($,W);case"Function":return $0($(),X);case"Number":case"Boolean":return new Response($.toString());case"Cookie":if($ instanceof K0)return new Response($.value,W);return new Response($?.toString(),W);case"FormData":return new Response($);default:if($ instanceof Response)return new Response($.body,{headers:{"Content-Type":"application/json"}});if($ instanceof Promise)return $.then((j)=>y(j,W));if($ instanceof Error)return Y0($,W);if(typeof $?.next==="function")return G0($,W,X);if("toResponse"in $)return y($.toResponse(),W);if("charCodeAt"in $){const j=$.charCodeAt(0);if(j===123||j===91){if(!W.headers["Content-Type"])W.headers["Content-Type"]="application/json";return new Response(JSON.stringify($),W)}}return new Response($)}},$0=($,W)=>{switch($?.constructor?.name){case"String":return new Response($);case"Blob":return u0($);case"Array":return Response.json($);case"Object":if($[d])return f($.response,{status:$[d],headers:{}});$:for(let X of Object.values($))switch(X?.constructor?.name){case"Blob":case"File":case"ArrayBuffer":case"FileRef":return new Response(N0($));case"Object":break $;default:break}return Response.json($);case"ReadableStream":return W?.signal.addEventListener("abort",{handleEvent(){if(!W?.signal.aborted)$.cancel(W)}},{once:!0}),new Response($,{headers:{"Content-Type":"text/event-stream; charset=utf-8"}});case void 0:if(!$)return new Response("");return new Response(JSON.stringify($),{headers:{"content-type":"application/json"}});case"Response":if($.headers.get("transfer-encoding")==="chunked")return G0(h0($));return $;case"Error":return Y0($);case"Promise":return $.then((X)=>$0(X,W));case"Function":return $0($(),W);case"Number":case"Boolean":return new Response($.toString());case"FormData":return new Response($);default:if($ instanceof Response)return new Response($.body,{headers:{"Content-Type":"application/json"}});if($ instanceof Promise)return $.then((X)=>$0(X,W));if($ instanceof Error)return Y0($);if(typeof $?.next==="function")return G0($,void 0,W);if("toResponse"in $)return $0($.toResponse());if("charCodeAt"in $){const X=$.charCodeAt(0);if(X===123||X===91)return new Response(JSON.stringify($),{headers:{"Content-Type":"application/json"}})}return new Response($)}},Y0=($,W)=>new Response(JSON.stringify({name:$?.name,message:$?.message,cause:$?.cause}),{status:W?.status!==200?W?.status??500:500,headers:W?.headers});function D3($){let W=$;while(W.endsWith("="))W=W.slice(0,-1);return W}var $1=($,W)=>{const X=new URL($);return X.pathname=W,X.toString()},K3=($)=>typeof $==="function"&&/^\s*class\s+/.test($.toString())||$.toString().startsWith("[object ")&&$.toString()!=="[object Object]"||p(Object.getPrototypeOf($)),I1=($)=>$&&typeof $==="object"&&!Array.isArray($),c=($,W,{skipKeys:X,override:Z=!0}={})=>{if(!I1($)||!I1(W))return $;for(let[j,J]of Object.entries(W)){if(X?.includes(j))continue;if(!I1(J)||!(j in $)||K3(J)){if(Z||!(j in $))$[j]=J;continue}$[j]=c($[j],J,{skipKeys:X,override:Z})}return $},w3=($,W)=>{const{properties:X,...Z}=$??{},{properties:j,...J}=W??{};return c(Z,J)},x=($=[],W=[])=>{if(!$)return[];if(!W)return $;const X=[],Z=[];if(!Array.isArray($))$=[$];if(!Array.isArray(W))W=[W];for(let j of $)if(X.push(j),j.checksum)Z.push(j.checksum);for(let j of W)if(!Z.includes(j.checksum))X.push(j);return X},_3=["start","request","parse","transform","resolve","beforeHandle","afterHandle","mapResponse","afterResponse","trace","error","stop","body","headers","params","query","response","type","detail"],F3=_3.reduce(($,W)=>($[W]=!0,$),{}),G2=($,W)=>{const X=(Z)=>typeof Z==="object"&&Object.keys(Z).every(J1);if(X($)&&X(W))return{...$,...W};return W??$},b0=($,W)=>{return{body:W?.body??$?.body,headers:W?.headers??$?.headers,params:W?.params??$?.params,query:W?.query??$?.query,cookie:W?.cookie??$?.cookie,response:G2($?.response,W?.response)}},l=($,W)=>{return{...$,...W,body:W?.body??$?.body,headers:W?.headers??$?.headers,params:W?.params??$?.params,query:W?.query??$?.query,cookie:W?.cookie??$?.cookie,response:G2($?.response,W?.response),type:$?.type||W?.type,detail:c(W?.detail??{},$?.detail??{}),parse:x($?.parse,W?.parse),transform:x($?.transform,W?.transform),beforeHandle:x($?.beforeHandle,W?.beforeHandle),afterHandle:x($?.afterHandle,W?.afterHandle),mapResponse:x($?.mapResponse,W?.mapResponse),afterResponse:x($?.afterResponse,W?.afterResponse),trace:x($?.trace,W?.trace),error:x($?.error,W?.error)}},Y2=($,W,X=!0)=>{if(!Array.isArray(W))return h($,W,X);for(let Z of W)$=h($,Z,X);return $},h=($,W,X=!0)=>{if(!$)return $;if(W.untilObjectFound&&!X&&$.type==="object")return $;const Z=W.from[R0];if($.oneOf){for(let Q=0;Q<$.oneOf.length;Q++)$.oneOf[Q]=h($.oneOf[Q],W,X);return $}if($.anyOf){for(let Q=0;Q<$.anyOf.length;Q++)$.anyOf[Q]=h($.anyOf[Q],W,X);return $}if($.allOf){for(let Q=0;Q<$.allOf.length;Q++)$.allOf[Q]=h($.allOf[Q],W,X);return $}if($.not){for(let Q=0;Q<$.not.length;Q++)$.not[Q]=h($.not[Q],W,X);return $}const j=X&&!!W.excludeRoot;if($[R0]===Z){const{anyOf:Q,oneOf:Y,allOf:U,not:B,properties:K,items:w,...F}=$,G=W.to();let M;const D=(z)=>{if(K&&z.type==="object"){const V={};for(let[A,L]of Object.entries(K))V[A]=h(L,W,!1);return{...F,...z,properties:V}}if(w&&z.type==="array")return{...F,...z,items:h(w,W,!1)};const I={...F,...z};if(delete I.required,K&&z.type==="string"&&z.format==="ObjectString"&&z.default==="{}")M=O.ObjectString(K,F),I.default=JSON.stringify(B0.Create(O.Object(K))),I.properties=K;if(w&&z.type==="string"&&z.format==="ArrayString"&&z.default==="[]")M=O.ArrayString(w,F),I.default=JSON.stringify(B0.Create(O.Array(w))),I.items=w;return I};if(j){if(K){const z={};for(let[I,V]of Object.entries(K))z[I]=h(V,W,!1);return{...F,properties:z}}else if(w?.map)return{...F,items:w.map((z)=>h(z,W,!1))};return F}if(G.anyOf)for(let z=0;z<G.anyOf.length;z++)G.anyOf[z]=D(G.anyOf[z]);else if(G.oneOf)for(let z=0;z<G.oneOf.length;z++)G.oneOf[z]=D(G.oneOf[z]);else if(G.allOf)for(let z=0;z<G.allOf.length;z++)G.allOf[z]=D(G.allOf[z]);else if(G.not)for(let z=0;z<G.not.length;z++)G.not[z]=D(G.not[z]);if(M)G[J2]=M[J2];if(G.anyOf||G.oneOf||G.allOf||G.not)return G;if(K){const z={};for(let[I,V]of Object.entries(K))z[I]=h(V,W,!1);return{...F,...G,properties:z}}else if(w?.map)return{...F,...G,items:w.map((z)=>h(z,W,!1))};return{...F,...G}}const J=$?.properties;if(J)for(let[Q,Y]of Object.entries(J))switch(Y[R0]){case Z:const{anyOf:U,oneOf:B,allOf:K,not:w,type:F,...G}=Y,M=W.to();if(M.anyOf)for(let D=0;D<M.anyOf.length;D++)M.anyOf[D]={...G,...M.anyOf[D]};else if(M.oneOf)for(let D=0;D<M.oneOf.length;D++)M.oneOf[D]={...G,...M.oneOf[D]};else if(M.allOf)for(let D=0;D<M.allOf.length;D++)M.allOf[D]={...G,...M.allOf[D]};else if(M.not)for(let D=0;D<M.not.length;D++)M.not[D]={...G,...M.not[D]};J[Q]={...G,...h(G,W,!1)};break;case"Object":case"Union":J[Q]=h(Y,W,!1);break;default:if(Y.items)for(let D=0;D<Y.items.length;D++)Y.items[D]=h(Y.items[D],W,!1);else if(Y.anyOf||Y.oneOf||Y.allOf||Y.not)J[Q]=h(Y,W,!1);break}return $},m=($,{models:W={},dynamic:X=!1,normalize:Z=!1,additionalProperties:j=!1,coerce:J=!1,additionalCoerce:Q=[]}={})=>{if(!$)return;if(typeof $==="string"&&!($ in W))return;let Y=typeof $==="string"?W[$]:$;if(J)Y=Y2(Y,[{from:O.Number(),to:()=>O.Numeric(),untilObjectFound:!0},{from:O.Boolean(),to:()=>O.BooleanString(),untilObjectFound:!0},...Array.isArray(Q)?Q:[Q]]);if(Y.type==="object"&&"additionalProperties"in Y===!1)Y.additionalProperties=j;const U=(K)=>B0.Clean(Y,K);if(X){const K={schema:Y,references:"",checkFunc:()=>{},code:"",Check:(w)=>B0.Check(Y,w),Errors:(w)=>B0.Errors(Y,w),Code:()=>"",Clean:U};if(Z&&Y.additionalProperties===!1)K.Clean=U;if(Y.config){if(K.config=Y.config,K?.schema?.config)delete K.schema.config}return K.parse=(w)=>{try{return K.Decode(w)}catch(F){throw[...K.Errors(w)].map(r)}},K.safeParse=(w)=>{try{return{success:!0,data:K.Decode(w),error:null}}catch(F){const G=[...B.Errors(w)].map(r);return{success:!1,data:null,error:G[0]?.summary,errors:G}}},K}const B=Q2.Compile(Y,Object.values(W));if(B.Clean=U,Y.config){if(B.config=Y.config,B?.schema?.config)delete B.schema.config}return B.parse=(K)=>{try{return B.Decode(K)}catch(w){throw[...B.Errors(K)].map(r)}},B.safeParse=(K)=>{try{return{success:!0,data:B.Decode(K),error:null}}catch(w){const F=[...B.Errors(K)].map(r);return{success:!1,data:null,error:F[0]?.summary,errors:F}}},B},W1=($,{models:W={},dynamic:X=!1,normalize:Z=!1,additionalProperties:j=!1})=>{if(!$)return;if(typeof $==="string"&&!($ in W))return;const J=typeof $==="string"?W[$]:$,Q=(U,B)=>{const K=(F)=>{if(!F||typeof F!=="object")return B0.Clean(U,F);if(Array.isArray(F))F=B0.Clean(U,F);else F=B0.Clean(U,F);return F};if(X)return{schema:U,references:"",checkFunc:()=>{},code:"",Check:(F)=>B0.Check(U,F),Errors:(F)=>B0.Errors(U,F),Code:()=>""};const w=Q2.Compile(U,B);if(Z&&U.additionalProperties===!1)w.Clean=K;return w};if(R0 in J){if("additionalProperties"in J===!1)J.additionalProperties=j;return{200:Q(J,Object.values(W))}}const Y={};return Object.keys(J).forEach((U)=>{const B=J[+U];if(typeof B==="string"){if(B in W){const K=W[B];K.type==="object"&&"additionalProperties"in K,Y[+U]=R0 in K?Q(K,Object.values(W)):K}return}if(B.type==="object"&&"additionalProperties"in B===!1)B.additionalProperties=j;Y[+U]=R0 in B?Q(B,Object.values(W)):B}),Y},M3=typeof Bun!=="undefined",z3=M3&&typeof Bun.hash==="function",P0=($)=>{if(z3)return Bun.hash($);let W=9;for(let X=0;X<$.length;)W=Math.imul(W^$.charCodeAt(X++),387420489);return W=W^W>>>9},V1,D0=()=>{if(!V1)V1=[{from:O.Object({}),to:()=>O.ObjectString({}),excludeRoot:!0},{from:O.Array(O.Any()),to:()=>O.ArrayString(O.Any())}];return V1},X1=({validator:$,defaultConfig:W={},config:X,dynamic:Z,models:j})=>{let J=m($,{dynamic:Z,models:j,additionalProperties:!0,coerce:!0,additionalCoerce:D0()});if(p(W))if(J)J.config=w3(J.config,X);else J=m(O.Cookie({}),{dynamic:Z,models:j,additionalProperties:!0}),J.config=W;return J},W0=($,W)=>{if(!W)return;if(!Array.isArray(W)){const Z=W;if($&&!Z.checksum)Z.checksum=$;if(Z.scope==="scoped")Z.scope="local";return Z}const X=[...W];for(let Z of X){if($&&!Z.checksum)Z.checksum=$;if(Z.scope==="scoped")Z.scope="local"}return X},A1=($,W,X)=>{return{start:x($.start,W0(X,W?.start)),request:x($.request,W0(X,W?.request)),parse:x($.parse,W0(X,W?.parse)),transform:x($.transform,W0(X,W?.transform)),beforeHandle:x($.beforeHandle,W0(X,W?.beforeHandle)),afterHandle:x($.afterHandle,W0(X,W?.afterHandle)),mapResponse:x($.mapResponse,W0(X,W?.mapResponse)),afterResponse:x($.afterResponse,W0(X,W?.afterResponse)),trace:x($.trace,W0(X,W?.trace)),error:x($.error,W0(X,W?.error)),stop:x($.stop,W0(X,W?.stop))}},B2=($,W,{skipIfHasType:X=!1}={})=>{if(!$)return $;if(!Array.isArray($)){if(X)$.scope??=W;else $.scope=W;return $}for(let Z of $)if(X)Z.scope??=W;else Z.scope=W;return $},z0=($)=>{if(!$)return $;if(!Array.isArray($))switch($.scope){case"global":case"scoped":return{...$};default:return{fn:$}}const W=[];for(let X of $)switch(X.scope){case"global":case"scoped":W.push({...X});break}return W},O1=($)=>{return{...$,type:$?.type,detail:$?.detail,parse:z0($?.parse),transform:z0($?.transform),beforeHandle:z0($?.beforeHandle),afterHandle:z0($?.afterHandle),mapResponse:z0($?.mapResponse),afterResponse:z0($?.afterResponse),error:z0($?.error),trace:z0($?.trace)}},w0={Continue:100,"Switching Protocols":101,Processing:102,"Early Hints":103,OK:200,Created:201,Accepted:202,"Non-Authoritative Information":203,"No Content":204,"Reset Content":205,"Partial Content":206,"Multi-Status":207,"Already Reported":208,"Multiple Choices":300,"Moved Permanently":301,Found:302,"See Other":303,"Not Modified":304,"Temporary Redirect":307,"Permanent Redirect":308,"Bad Request":400,Unauthorized:401,"Payment Required":402,Forbidden:403,"Not Found":404,"Method Not Allowed":405,"Not Acceptable":406,"Proxy Authentication Required":407,"Request Timeout":408,Conflict:409,Gone:410,"Length Required":411,"Precondition Failed":412,"Payload Too Large":413,"URI Too Long":414,"Unsupported Media Type":415,"Range Not Satisfiable":416,"Expectation Failed":417,"I'm a teapot":418,"Misdirected Request":421,"Unprocessable Content":422,Locked:423,"Failed Dependency":424,"Too Early":425,"Upgrade Required":426,"Precondition Required":428,"Too Many Requests":429,"Request Header Fields Too Large":431,"Unavailable For Legal Reasons":451,"Internal Server Error":500,"Not Implemented":501,"Bad Gateway":502,"Service Unavailable":503,"Gateway Timeout":504,"HTTP Version Not Supported":505,"Variant Also Negotiates":506,"Insufficient Storage":507,"Loop Detected":508,"Not Extended":510,"Network Authentication Required":511},Z1=Object.fromEntries(Object.entries(w0).map(([$,W])=>[W,$])),j2=new TextEncoder,x0=async($,W)=>{if(typeof $!=="string")throw new TypeError("Cookie value must be provided as a string.");if(W===null)throw new TypeError("Secret key must be provided.");const X=await crypto.subtle.importKey("raw",j2.encode(W),{name:"HMAC",hash:"SHA-256"},!1,["sign"]),Z=await crypto.subtle.sign("HMAC",X,j2.encode($));return $+"."+D3(Buffer.from(Z).toString("base64"))},P1=async($,W)=>{if(typeof $!=="string")throw new TypeError("Signed cookie string must be provided.");if(W===null)throw new TypeError("Secret key must be provided.");const X=$.slice(0,$.lastIndexOf("."));return await x0(X,W)===$?X:!1},U2=($,W)=>{if(!$||typeof $!=="object"||!W)return;for(let[X,Z]of Object.entries(W)){if(X in F3||!(X in $))continue;const j=$[X];if(typeof j==="function")j(Z),delete W[X]}},K2=({globalHook:$,localHook:W})=>(X)=>(Z,j)=>{if(typeof Z==="function")Z={fn:Z};if("fn"in Z||Array.isArray(Z)){if(!W[X])W[X]=[];if(typeof W[X]==="function")W[X]=[W[X]];if(Array.isArray(Z))W[X]=W[X].concat(Z);else W[X].push(Z);return}const{insert:J="after",stack:Q="local"}=Z;if(typeof j==="function")j={fn:j};if(Q==="global")if(!Array.isArray(j))if(J==="before")$[X].unshift(j);else $[X].push(j);else if(J==="before")$[X]=j.concat($[X]);else $[X]=$[X].concat(j);else{if(!W[X])W[X]=[];if(typeof W[X]==="function")W[X]=[W[X]];if(!Array.isArray(j))if(J==="before")W[X].unshift(j);else W[X].push(j);else if(J==="before")W[X]=j.concat(W[X]);else W[X]=W[X].concat(j)}},N3=($)=>{if(typeof $==="number")return $;if($.length<16){if($.trim().length===0)return null;const W=Number($);if(Number.isNaN(W))return null;return W}if($.length===16){if($.trim().length===0)return null;const W=Number($);if(Number.isNaN(W)||W.toString()!==$)return null;return W}return null},J1=($)=>N3($)!==null;class C1{$;root=null;promises=[];constructor($=console.error){this.onError=$}get size(){return this.promises.length}add($){return this.promises.push($),this.root||=this.drain(),$}async drain(){while(this.promises.length>0){try{await this.promises[0]}catch($){this.onError($)}this.promises.shift()}this.root=null}then($,W){return(this.root??Promise.resolve()).then($,W)}}var i=($)=>{if(!$)return $;if(!Array.isArray($)){if(typeof $==="function")return{fn:$};else if("fn"in $)return $}const W=[];for(let X of $)if(typeof X==="function")W.push({fn:X});else if("fn"in X)W.push(X);return W},w2=($)=>{return{...$,start:i($?.start),request:i($?.request),parse:i($?.parse),transform:i($?.transform),beforeHandle:i($?.beforeHandle),afterHandle:i($?.afterHandle),mapResponse:i($?.mapResponse),afterResponse:i($?.afterResponse),trace:i($?.trace),error:i($?.error),stop:i($?.stop)}},S1=($)=>{return{...$,start:$.start?.map((W)=>W.fn),request:$.request?.map((W)=>W.fn),parse:$.parse?.map((W)=>W.fn),transform:$.transform?.map((W)=>W.fn),beforeHandle:$.beforeHandle?.map((W)=>W.fn),afterHandle:$.afterHandle?.map((W)=>W.fn),afterResponse:$.afterResponse?.map((W)=>W.fn),mapResponse:$.mapResponse?.map((W)=>W.fn),trace:$.trace?.map((W)=>W.fn),error:$.error?.map((W)=>W.fn),stop:$.stop?.map((W)=>W.fn)}},m0=($)=>({body:$.body,cookie:$.cookie,headers:$.headers,query:$.query,set:$.set,server:$.server}),d0=($,W=302)=>Response.redirect($,W),P3=Symbol("ElysiaFormData"),I0=Symbol("ElysiaRequestId"),N0=($)=>{const W=new FormData;for(let[X,Z]of Object.entries($)){if(Array.isArray(Z)){for(let j of Z){if(Z instanceof File)W.append(X,Z,Z.name);W.append(X,j)}continue}if(Z instanceof File)W.append(X,Z,Z.name);W.append(X,Z)}return W},j1=()=>crypto.getRandomValues(new Uint32Array(1))[0],Q1=($)=>{const W=[];for(let X=0;X<$.length;X++){const Z=$[X];if(Z.checksum){if(W.includes(Z.checksum))$.splice(X,1),X--;W.push(Z.checksum)}}return $},k=($,W="scoped")=>{if(W==="scoped"){for(let X of $)if("scope"in X&&X.scope==="local")X.scope="scoped";return}for(let X of $)if("scope"in X)X.scope="global"};var _2=typeof Bun!=="undefined"?Bun.env:typeof process!=="undefined"?process?.env:void 0,V0=Symbol("ElysiaErrorCode"),d=Symbol("ElysiaResponse"),l0=(_2?.NODE_ENV??_2?.ENV)==="production",L1=($,W)=>{const X=W??($ in Z1?Z1[$]:$);return{[d]:w0[$]??$,response:X,_type:void 0,error:new Error(X)}};class G1 extends Error{code="INTERNAL_SERVER_ERROR";status=500;constructor($){super($??"INTERNAL_SERVER_ERROR")}}class A0 extends Error{code="NOT_FOUND";status=404;constructor($){super($??"NOT_FOUND")}}class Y1 extends Error{code="PARSE";status=400;constructor(){super("Failed to parse body")}}class v0 extends Error{$;code="INVALID_COOKIE_SIGNATURE";status=400;constructor($,W){super(W??`"${$}" has invalid cookie signature`);this.key=$}}var r=($)=>{if(!$)return{summary:void 0};const{message:W,path:X,value:Z,type:j}=$,J=X.slice(1).replaceAll("/","."),Q=X==="";switch(j){case 42:return{...$,summary:Q?"Value should not be provided":`Property '${J}' should not be provided`};case 45:return{...$,summary:Q?"Value is missing":`Property '${J}' is missing`};case 50:const Y=W.indexOf("'"),U=W.slice(Y+1,W.indexOf("'",Y+1));return{...$,summary:Q?"Value should be an email":`Property '${J}' should be ${U}`};case 54:return{...$,summary:`${W.slice(0,9)} property '${J}' to be ${W.slice(8)} but found: ${Z}`};case 62:const B=$.schema.anyOf.map((K)=>`'${K?.format??K.type}'`).join(", ");return{...$,summary:Q?`Value should be one of ${B}`:`Property '${J}' should be one of: ${B}`};default:return{summary:W,...$}}};class T extends Error{$;W;X;code="VALIDATION";status=422;constructor($,W,X){if(X&&typeof X==="object"&&d in X)X=X.response;const Z=l0?void 0:("Errors"in W)?W.Errors(X).First():c0.Errors(W,X).First(),j=Z?.schema.error!==void 0?typeof Z.schema.error==="function"?Z.schema.error({type:$,validator:W,value:X,get errors(){return[...W.Errors(X)].map(r)}}):Z.schema.error:void 0,J=Z?.path||"root";let Q="";if(j!==void 0)Q=typeof j==="object"?JSON.stringify(j):j+"";else if(l0)Q=JSON.stringify({type:"validation",on:$,summary:r(Z).summary,message:Z?.message,found:X});else{const Y=W?.schema??W,U="Errors"in W?[...W.Errors(X)].map(r):[...c0.Errors(W,X)].map(r);let B;try{B=c0.Create(Y)}catch(K){B={type:"Could not create expected value",message:K?.message,error:K}}Q=JSON.stringify({type:"validation",on:$,summary:U[0]?.summary,property:J,message:Z?.message,expected:B,found:X,errors:U},null,2)}super(Q);this.type=$;this.validator=W;this.value=X;Object.setPrototypeOf(this,T.prototype)}get all(){return"Errors"in this.validator?[...this.validator.Errors(this.value)].map(r):[...c0.Errors(this.validator,this.value)].map(r)}static simplifyModel($){const W="schema"in $?$.schema:$;try{return c0.Create(W)}catch{return W}}get model(){return T.simplifyModel(this.validator)}toResponse($){return new Response(this.message,{status:400,headers:{...$,"content-type":"application/json"}})}}var q1={open($){$.data.open?.($)},message($,W){$.data.message?.($,W)},drain($){$.data.drain?.($)},close($,W,X){$.data.close?.($,W,X)}};class g0{$;W;validator;_validator;constructor($,W){this.raw=$;this.data=W;if(this.validator=$.data.validator,$.data.id)this.id=$.data.id;else this.id=j1().toString()}get id(){return this.raw.data.id}set id($){this.raw.data.id=$}get publish(){return($,W=void 0,X)=>{if(this.validator?.Check(W)===!1)throw new T("message",this.validator,W);if(typeof W==="object")W=JSON.stringify(W);return this.raw.publish($,W,X),this}}get send(){return($)=>{if(this.validator?.Check($)===!1)throw new T("message",this.validator,$);if(Buffer.isBuffer($))return this.raw.send($),this;if(typeof $==="object")$=JSON.stringify($);return this.raw.send($),this}}get subscribe(){return($)=>{return this.raw.subscribe($),this}}get unsubscribe(){return($)=>{return this.raw.unsubscribe($),this}}get cork(){return($)=>{return this.raw.cork($),this}}get close(){return()=>{return this.raw.close(),this}}get terminate(){return this.raw.terminate.bind(this.raw)}get isSubscribed(){return this.raw.isSubscribed.bind(this.raw)}get remoteAddress(){return this.raw.remoteAddress}}var T1="1.1.9";import{Value as n0}from"@sinclair/typebox/value";var O0=w1(o0(),1);function B1($){const W={};if(typeof $!=="string")return W;let X="",Z="",j=-1,J=-1,Q=0;const Y=$.length;for(let U=0;U<Y;U++)switch($.charCodeAt(U)){case 38:const B=J>j;if(!B)J=U;if(X=$.slice(j+1,J),B||X.length>0){if(Q&1)X=X.replace(f0," ");if(Q&2)X=O0.default(X)||X;if(!W[X]){if(B){if(Z=$.slice(J+1,U),Q&4)Z=Z.replace(f0," ");if(Q&8)Z=O0.default(Z)||Z}W[X]=Z}}X="",Z="",j=U,J=U,Q=0;break;case 61:if(J<=j)J=U;else Q|=8;break;case 43:if(J>j)Q|=4;else Q|=1;break;case 37:if(J>j)Q|=8;else Q|=2;break}if(j<Y){const U=J>j;if(X=$.slice(j+1,U?J:Y),U||X.length>0){if(Q&1)X=X.replace(f0," ");if(Q&2)X=O0.default(X)||X;if(!W[X]){if(U){if(Z=$.slice(J+1,Y),Q&4)Z=Z.replace(f0," ");if(Q&8)Z=O0.default(Z)||Z}W[X]=Z}}}return W}var f0=/\+/g,p0=($)=>{const W={};if(typeof $!=="string")return W;const X=$.length;let Z="",j="",J=-1,Q=-1,Y=!1,U=!1,B=!1,K=!1,w=!1,F=0;for(let G=0;G<X+1;G++){if(G!==X)F=$.charCodeAt(G);else F=38;switch(F){case 38:{if(w=Q>J,!w)Q=G;if(Z=$.slice(J+1,Q),w||Z.length>0){if(B)Z=Z.replace(f0," ");if(Y)Z=O0.default(Z)||Z;if(w){if(j=$.slice(Q+1,G),K)j=j.replace(f0," ");if(U)j=O0.default(j)||j}const M=W[Z];if(M===void 0)W[Z]=j;else if(M.pop)M.push(j);else W[Z]=[M,j]}j="",J=G,Q=G,Y=!1,U=!1,B=!1,K=!1;break}case 61:if(Q<=J)Q=G;else U=!0;break;case 43:if(Q>J)K=!0;else B=!0;break;case 37:if(Q>J)U=!0;else Y=!0;break}}return W};var M2=w1(o0(),1);var i0=Symbol("ElysiaTrace"),_0=()=>{const{promise:$,resolve:W}=Promise.withResolvers(),{promise:X,resolve:Z}=Promise.withResolvers(),{promise:j,resolve:J}=Promise.withResolvers(),Q=[],Y=[];return[(U)=>{if(U)Q.push(U);return $},(U)=>{const B=[],K=[];let w=null;for(let G=0;G<(U.total??0);G++){const{promise:M,resolve:D}=Promise.withResolvers(),{promise:z,resolve:I}=Promise.withResolvers(),{promise:V,resolve:A}=Promise.withResolvers(),L=[],q=[];B.push((E)=>{if(E)L.push(E);return M}),K.push((E)=>{const v={...E,end:z,error:V,index:G,onStop(R){if(R)q.push(R);return z}};D(v);for(let R=0;R<L.length;R++)L[R](v);return(R=null)=>{const F0=performance.now();if(R)w=R;const b={end:F0,error:R,get elapsed(){return F0-E.begin}};for(let J0=0;J0<q.length;J0++)q[J0](b);I(F0),A(R)}})}const F={...U,end:X,error:j,onEvent(G){for(let M=0;M<B.length;M++)B[M](G)},onStop(G){if(G)Y.push(G);return X}};W(F);for(let G=0;G<Q.length;G++)Q[G](F);return{resolveChild:K,resolve(G=null){const M=performance.now();if(!G&&w)G=w;const D={end:M,error:G,get elapsed(){return M-U.begin}};for(let z=0;z<Y.length;z++)Y[z](D);Z(M),J(G)}}}]},F2=($)=>{return(W)=>{const[X,Z]=_0(),[j,J]=_0(),[Q,Y]=_0(),[U,B]=_0(),[K,w]=_0(),[F,G]=_0(),[M,D]=_0(),[z,I]=_0(),[V,A]=_0();return $({id:W[I0],context:W,set:W.set,onRequest:X,onParse:j,onTransform:Q,onBeforeHandle:U,onHandle:K,onAfterHandle:F,onMapResponse:z,onAfterResponse:V,onError:M}),{request:Z,parse:J,transform:Y,beforeHandle:B,handle:w,afterHandle:G,error:D,mapResponse:I,afterResponse:A}}};var V3=new Headers().toJSON,z2={optional:Symbol.for("TypeBox.Optional"),kind:Symbol.for("TypeBox.Kind")},n=($)=>{if(!$)return!1;const W=$?.schema;return!!W&&z2.optional in W},X0=($)=>{if(!$)return!1;const W=$?.schema??$;if(W.anyOf)return W.anyOf.some(X0);if(W.someOf)return W.someOf.some(X0);if(W.allOf)return W.allOf.some(X0);if(W.not)return W.not.some(X0);if(W.type==="object"){const X=W.properties;if("additionalProperties"in W)return W.additionalProperties;for(let Z of Object.keys(X)){const j=X[Z];if(j.type==="object"){if(X0(j))return!0}else if(j.anyOf){for(let J=0;J<j.anyOf.length;J++)if(X0(j.anyOf[J]))return!0}return j.additionalProperties}return!1}return!1},E1=({context:$="c",trace:W,addFn:X})=>{if(!W.length)return()=>{return{resolveChild(){return()=>{}},resolve(){}}};for(let Z=0;Z<W.length;Z++)X(`let report${Z}, reportChild${Z}, reportErr${Z}, reportErrChild${Z}; let trace${Z} = ${$}[ELYSIA_TRACE]?.[${Z}] ?? trace[${Z}](${$});\n`);return(Z,{name:j,total:J=0}={})=>{if(!j)j="anonymous";const Q=Z==="error"?"reportErr":"report";for(let Y=0;Y<W.length;Y++)X(`\n${Q}${Y} = trace${Y}.${Z}({id,event: '${Z}',name: '${j}',begin: performance.now(),total: ${J}})\n`);return{resolve(){for(let Y=0;Y<W.length;Y++)X(`\n${Q}${Y}.resolve()\n`)},resolveChild(Y){for(let U=0;U<W.length;U++)X(`${Q}Child${U} = ${Q}${U}.resolveChild?.shift()?.({id,event: '${Z}',name: '${Y}',begin: performance.now()})\n`);return(U)=>{for(let B=0;B<W.length;B++)if(U)X(`
                             	if (${U} instanceof Error)
                    				${Q}Child${B}?.(${U})
                           		else
                             		${Q}Child${B}?.()\n`);else X(`${Q}Child${B}?.()\n`)}}}}},A3=({injectResponse:$="",normalize:W=!1,validator:X})=>({composeValidation:(Z,j=`c.${Z}`)=>`c.set.status = 422; throw new ValidationError('${Z}', validator.${Z}, ${j})`,composeResponseValidation:(Z="r")=>{let j="\n"+$+"\n";j+=`if(typeof ${Z} === "object" && ${Z} && ELYSIA_RESPONSE in ${Z}) {
			c.set.status = ${Z}[ELYSIA_RESPONSE]
			${Z} = ${Z}.response
		}

		const isResponse = ${Z} instanceof Response\n\n`,j+="switch(c.set.status) {\n";for(let[J,Q]of Object.entries(X.response)){if(j+=`\tcase ${J}:
				if (!isResponse) {\n`,W&&"Clean"in Q&&!X0(Q))j+=`${Z} = validator.response['${J}'].Clean(${Z})\n`;j+=`if(validator.response['${J}'].Check(${Z}) === false) {
					c.set.status = 422

					throw new ValidationError('response', validator.response['${J}'], ${Z})
				}

				c.set.status = ${J}
			}

			break\n\n`}return j+="\n}\n",j}}),h8=Symbol.for("TypeBox.Kind");var C0=($,W)=>{if(!W)return;if(W.type==="object"){const X=W.properties;if(!X)return!1;for(let Z of Object.keys(X)){const j=X[Z];if($ in j)return!0;if(j.type==="object"){if(C0($,j))return!0}else if(j.anyOf){for(let J=0;J<j.anyOf.length;J++)if(C0($,j.anyOf[J]))return!0}}return!1}return $ in W},H1=Symbol.for("TypeBox.Transform"),S0=($)=>{if(!$)return;if($.type==="object"&&$.properties){const W=$.properties;for(let X of Object.keys(W)){const Z=W[X];if(Z.type==="object"){if(S0(Z))return!0}else if(Z.anyOf){for(let J=0;J<Z.anyOf.length;J++)if(S0(Z.anyOf[J]))return!0}if(H1 in Z)return!0}return!1}return H1 in $||$.properties&&H1 in $.properties},O3=/(?:return|=>) \S+\(/g,L0=($)=>{return($?.fn??$).constructor.name==="AsyncFunction"},g=($)=>{const W=$?.fn??$;if(W.constructor.name==="AsyncFunction")return!0;const X=W.toString();if(X.includes("=> response.clone("))return!1;if(X.includes("await"))return!0;if(X.includes("async"))return!0;return!!X.match(O3)},U1=($)=>{const W=$?.fn??$;return W.constructor.name==="AsyncGeneratorFunction"||W.constructor.name==="GeneratorFunction"},D2=({app:$,path:W,method:X,localHook:Z,hooks:j,validator:J,handler:Q,allowMeta:Y=!1,inference:U})=>{const B=typeof Q==="function";if(!B)Q=f(Q,{headers:$.setHeaders??{}});const K=B?"handler(c)":"handler",w=j.afterResponse.length>0,F=j.trace.length>0;let G="";if(U=s0(Object.assign(Z,{handler:Q}),U),U.server)G+=`\nObject.defineProperty(c, 'server', {
			get: function() { return getServer() }
		})\n`;if(U.body)G+="let isParsing = false\n";J.createBody?.(),J.createQuery?.(),J.createHeaders?.(),J.createParams?.(),J.createCookie?.(),J.createResponse?.();const M=U.query||!!J.query,D=X!=="$INTERNALWS"&&X!=="GET"&&X!=="HEAD"&&(U.body||!!J.body||j.parse.length),z=$.setHeaders,I=z&&!!Object.keys(z).length,V=U.headers||J.headers,A=U.cookie||!!J.cookie,L=A?X1({validator:J.cookie,defaultConfig:$.config.cookie,dynamic:!!$.config.aot,config:J.cookie?.config??{},models:$.definitions.type}):void 0,q=L?.config;let E="";if(q?.sign){if(!q.secrets)throw new Error(`t.Cookie required secret which is not set in (${X}) ${W}.`);const N=!q.secrets?void 0:typeof q.secrets==="string"?q.secrets:q.secrets[0];if(E+=`const _setCookie = c.set.cookie
		if(_setCookie) {`,q.sign===!0)E+=`for(const [key, cookie] of Object.entries(_setCookie)) {
				c.set.cookie[key].value = await signCookie(cookie.value, '${N}')
			}`;else for(let _ of q.sign)E+=`if(_setCookie['${_}']?.value) { c.set.cookie['${_}'].value = await signCookie(_setCookie['${_}'].value, '${N}') }\n`;E+="}\n"}const v=$.config.normalize,{composeValidation:R,composeResponseValidation:F0}=A3({normalize:v,validator:J});if(V)G+=V3?"c.headers = c.request.headers.toJSON()\n":`c.headers = {}
                for (const [key, value] of c.request.headers.entries())
					c.headers[key] = value
				`;if(A){const N=(P,C)=>{const S=q?.[P]??C;if(!S)return typeof C==="string"?`${P}: "${C}",`:`${P}: ${C},`;if(typeof S==="string")return`${P}: '${S}',`;if(S instanceof Date)return`${P}: new Date(${S.getTime()}),`;return`${P}: ${S},`},_=q?`{
			secrets: ${q.secrets!==void 0?typeof q.secrets==="string"?`'${q.secrets}'`:"["+q.secrets.reduce((P,C)=>P+`'${C}',`,"")+"]":"undefined"},
			sign: ${q.sign===!0?!0:q.sign!==void 0?"["+q.sign.reduce((P,C)=>P+`'${C}',`,"")+"]":"undefined"},
			${N("domain")}
			${N("expires")}
			${N("httpOnly")}
			${N("maxAge")}
			${N("path","/")}
			${N("priority")}
			${N("sameSite")}
			${N("secure")}
		}`:"undefined";if(V)G+=`\nc.cookie = await parseCookie(c.set, c.headers.cookie, ${_})\n`;else G+=`\nc.cookie = await parseCookie(c.set, c.request.headers.get('cookie'), ${_})\n`}if(M){const N=[];if(J.query&&J.query.schema.type==="object"){const _=J.query.schema.properties;if(!X0(J.query))for(let[P,C]of Object.entries(_)){let S=C;if(S&&z2.optional in S&&S.type==="array"&&S.items)S=S.items;const{type:s,anyOf:H}=S,U0=s==="array"||H?.some((u)=>u.type==="string"&&u.format==="ArrayString");N.push({key:P,isArray:U0,isNestedObjectArray:U0&&S.items?.type==="object"||!!S.items?.anyOf?.some((u)=>u.type==="object"||u.type==="array"),isObject:s==="object"||H?.some((u)=>u.type==="string"&&u.format==="ArrayString"),anyOf:!!H})}}if(!N.length)G+=`if(c.qi === -1) {
				c.query = {}
			} else {
				c.query = parseQueryFromURL(c.url.slice(c.qi + 1))
			}`;else G+=`if(c.qi !== -1) {
				let url = '&' + c.url.slice(c.qi + 1)

				${N.map(({key:_,isArray:P,isObject:C,isNestedObjectArray:S,anyOf:s},H)=>{const U0=`${H===0?"let":""} memory = url.indexOf('&${_}=')
							let a${H}\n`;if(P)return U0+(S?`while (memory !== -1) {
											const start = memory + ${_.length+2}
											memory = url.indexOf('&', start)

											if(a${H} === undefined)
												a${H} = ''
											else
												a${H} += ','

											let temp

											if(memory === -1) temp = decodeURIComponent(url.slice(start))
											else temp = decodeURIComponent(url.slice(start, memory))

											const charCode = temp.charCodeAt(0)
											if(charCode !== 91 && charCode !== 123)
												temp = '"' + temp + '"'

											a${H} += temp

											if(memory === -1) break

											memory = url.indexOf('&${_}=', memory)
											if(memory === -1) break
										}

										try {
										    if(a${H}.charCodeAt(0) === 91)
												a${H} = JSON.parse(a${H})
											else
												a${H} = JSON.parse('[' + a${H} + ']')
										} catch {}\n`:`while (memory !== -1) {
											const start = memory + ${_.length+2}
											memory = url.indexOf('&', start)

											if(a${H} === undefined)
												a${H} = []

											if(memory === -1) {
												a${H}.push(decodeURIComponent(url.slice(start)))
												break
											}
											else a${H}.push(decodeURIComponent(url.slice(start, memory)))

											memory = url.indexOf('&${_}=', memory)
											if(memory === -1) break
										}\n`);if(C)return U0+`if (memory !== -1) {
										const start = memory + ${_.length+2}
										memory = url.indexOf('&', start)

										if(memory === -1) a${H} = decodeURIComponent(url.slice(start))
										else a${H} = decodeURIComponent(url.slice(start, memory))

										if (a${H} !== undefined) {
											try {
												a${H} = JSON.parse(a${H})
											} catch {}
										}
									}`;return U0+`if (memory !== -1) {
										const start = memory + ${_.length+2}
										memory = url.indexOf('&', start)

										if(memory === -1) a${H} = decodeURIComponent(url.slice(start))
										else {
											a${H} = decodeURIComponent(url.slice(start, memory))

											${s?`
											let deepMemory = url.indexOf('&${_}=', memory)

											if(deepMemory !== -1) {
												a${H} = [a${H}]
												let first = true

												while(true) {
													const start = deepMemory + ${_.length+2}
													if(first)
														first = false
													else
														deepMemory = url.indexOf('&', start)

													let value
													if(deepMemory === -1) value = decodeURIComponent(url.slice(start))
													else value = decodeURIComponent(url.slice(start, deepMemory))

													const vStart = value.charCodeAt(0)
													const vEnd = value.charCodeAt(value.length - 1)

													if((vStart === 91 && vEnd === 93) || (vStart === 123 && vEnd === 125))
														try {
															a${H}.push(JSON.parse(value))
														} catch {
														 	a${H}.push(value)
														}

													if(deepMemory === -1) break
												}
											}
												`:""}
										}
									}`}).join("\n")}

				c.query = {
					${N.map(({key:_},P)=>`'${_}': a${P}`).join(", ")}
				}
			} else {
				c.query = {}
			}`}if(F)G+="\nconst id = c[ELYSIA_REQUEST_ID]\n";const b=E1({trace:j.trace,addFn:(N)=>{G+=N}});G+="\ntry {\n";const J0=typeof Q==="function"&&g(Q),a=F||j.afterResponse.length>0?"c.response = ":"",y0=A||D||J0||j.parse.length>0||j.afterHandle.some(g)||j.beforeHandle.some(g)||j.transform.some(g)||j.mapResponse.some(g),P2=(typeof Q==="function"?U1(Q):!1)||j.beforeHandle.some(U1)||j.afterHandle.some(U1)||j.transform.some(U1),t0=U.cookie||U.set||V||F||J.response||B&&I||P2,t=", c.request";G+=`c.route = \`${W}\`\n`;const I2=b("parse",{total:j.parse.length});if(D){const N=j.parse.length||U.body||J.body;if(G+="isParsing = true\n",j.type&&!j.parse.length)switch(j.type){case"json":case"application/json":if(n(J.body))G+="try { c.body = await c.request.json() } catch {}";else G+="c.body = await c.request.json()";break;case"text":case"text/plain":G+="c.body = await c.request.text()\n";break;case"urlencoded":case"application/x-www-form-urlencoded":G+="c.body = parseQuery(await c.request.text())\n";break;case"arrayBuffer":case"application/octet-stream":G+="c.body = await c.request.arrayBuffer()\n";break;case"formdata":case"multipart/form-data":if(G+="c.body = {}\n",n(J.body))G+="let form; try { form = await c.request.formData() } catch {}";else G+="const form = await c.request.formData()";G+=`\nif(form)
						for (const key of form.keys()) {
							if (c.body[key])
								continue

							const value = form.getAll(key)
							if (value.length === 1)
								c.body[key] = value[0]
							else c.body[key] = value
						} else form = {}\n`;break}else if(N){if(G+="\n",G+=V?"let contentType = c.headers['content-type']":"let contentType = c.request.headers.get('content-type')",G+=`
				if (contentType) {
					const index = contentType.indexOf(';')
					if (index !== -1) contentType = contentType.substring(0, index)\n
					c.contentType = contentType\n`,j.parse.length){G+="let used = false\n";const _=b("parse",{total:j.parse.length});for(let P=0;P<j.parse.length;P++){const C=_.resolveChild(j.parse[P].fn.name),S=`bo${P}`;if(P!==0)G+="if(!used) {\n";if(G+=`let ${S} = parse[${P}](c, contentType)\n`,G+=`if(${S} instanceof Promise) ${S} = await ${S}\n`,G+=`if(${S} !== undefined) { c.body = ${S}; used = true }\n`,C(),P!==0)G+="}"}_.resolve()}if(G+="\ndelete c.contentType\n",j.parse.length)G+="if (!used) {";if(j.type&&!Array.isArray(j.type))switch(j.type){case"json":case"application/json":if(n(J.body))G+="try { c.body = await c.request.json() } catch {}";else G+="c.body = await c.request.json()";break;case"text":case"text/plain":G+="c.body = await c.request.text()\n";break;case"urlencoded":case"application/x-www-form-urlencoded":G+="c.body = parseQuery(await c.request.text())\n";break;case"arrayBuffer":case"application/octet-stream":G+="c.body = await c.request.arrayBuffer()\n";break;case"formdata":case"multipart/form-data":G+=`c.body = {}

							const form = await c.request.formData()
							for (const key of form.keys()) {
								if (c.body[key])
									continue

								const value = form.getAll(key)
								if (value.length === 1)
									c.body[key] = value[0]
								else c.body[key] = value
							}\n`;break}else G+=`
					switch (contentType) {
						case 'application/json':
							${n(J.body)?"try { c.body = await c.request.json() } catch {}":"c.body = await c.request.json()"}
							break

						case 'text/plain':
							c.body = await c.request.text()
							break

						case 'application/x-www-form-urlencoded':
							c.body = parseQuery(await c.request.text())
							break

						case 'application/octet-stream':
							c.body = await c.request.arrayBuffer();
							break

						case 'multipart/form-data':
							c.body = {}

							const form = await c.request.formData()
							for (const key of form.keys()) {
								if (c.body[key])
									continue

								const value = form.getAll(key)
								if (value.length === 1)
									c.body[key] = value[0]
								else c.body[key] = value
							}

							break
					}`;if(j.parse.length)G+="}";G+="}\n"}G+="\nisParsing = false\n"}if(I2.resolve(),j?.transform){const N=b("transform",{total:j.transform.length});if(j.transform.length)G+="\nlet transformed\n";for(let _=0;_<j.transform.length;_++){const P=j.transform[_],C=N.resolveChild(P.fn.name);if(G+=g(P)?`transformed = await transform[${_}](c)\n`:`transformed = transform[${_}](c)\n`,P.subType==="mapDerive")G+=`if(transformed?.[ELYSIA_RESPONSE])
					throw transformed
				else {
					transformed.request = c.request
					transformed.store = c.store
					transformed.qi = c.qi
					transformed.path = c.path
					transformed.url = c.url
					transformed.redirect = c.redirect
					transformed.set = c.set
					transformed.error = c.error

					c = transformed
			}`;else G+=`if(transformed?.[ELYSIA_RESPONSE])
					throw transformed
				else
					Object.assign(c, transformed)\n`;C()}N.resolve()}if(J){if(G+="\n",J.headers){if(v&&"Clean"in J.headers&&!X0(J.headers))G+="c.headers = validator.headers.Clean(c.headers);\n";if(C0("default",J.headers.schema))for(let[N,_]of Object.entries(n0.Default(J.headers.schema,{}))){const P=typeof _==="object"?JSON.stringify(_):typeof _==="string"?`'${_}'`:_;if(P!==void 0)G+=`c.headers['${N}'] ??= ${P}\n`}if(n(J.headers))G+="if(isNotEmpty(c.headers)) {";if(G+=`if(validator.headers.Check(c.headers) === false) {
				${R("headers")}
			}`,S0(J.headers.schema))G+="c.headers = validator.headers.Decode(c.headers)\n";if(n(J.headers))G+="}"}if(J.params){if(C0("default",J.params.schema))for(let[N,_]of Object.entries(n0.Default(J.params.schema,{}))){const P=typeof _==="object"?JSON.stringify(_):typeof _==="string"?`'${_}'`:_;if(P!==void 0)G+=`c.params['${N}'] ??= ${P}\n`}if(G+=`if(validator.params.Check(c.params) === false) {
				${R("params")}
			}`,S0(J.params.schema))G+="\nc.params = validator.params.Decode(c.params)\n"}if(J.query){if(v&&"Clean"in J.query&&!X0(J.query))G+="c.query = validator.query.Clean(c.query);\n";if(C0("default",J.query.schema))for(let[N,_]of Object.entries(n0.Default(J.query.schema,{}))){const P=typeof _==="object"?JSON.stringify(_):typeof _==="string"?`'${_}'`:_;if(P!==void 0)G+=`if(c.query['${N}'] === undefined) c.query['${N}'] = ${P}\n`}if(n(J.query))G+="if(isNotEmpty(c.query)) {";if(G+=`if(validator.query.Check(c.query) === false) {
          		${R("query")}
			}`,S0(J.query.schema))G+="\nc.query = validator.query.Decode(Object.assign({}, c.query))\n";if(n(J.query))G+="}"}if(J.body){if(v&&"Clean"in J.body&&!X0(J.body))G+="c.body = validator.body.Clean(c.body);\n";const N=S0(J.body.schema);if(N||n(J.body))G+='\nconst isNotEmptyObject = c.body && (typeof c.body === "object" && isNotEmpty(c.body))\n';if(C0("default",J.body.schema)){const _=n0.Default(J.body.schema,J.body.schema.type==="object"?{}:void 0),P=typeof _==="object"?JSON.stringify(_):typeof _==="string"?`'${_}'`:_;if(G+=`if(validator.body.Check(c.body) === false) {
					if (typeof c.body === 'object') {
						c.body = Object.assign(${P}, c.body)
					} else { c.body = ${P} }`,n(J.body))G+=`
					    if(isNotEmptyObject && validator.body.Check(c.body) === false) {
            				${R("body")}
             			}
                    }`;else G+=`
    				if(validator.body.Check(c.body) === false) {
        				${R("body")}
         			}
                }`}else if(n(J.body))G+=`if(isNotEmptyObject && validator.body.Check(c.body) === false) {
         			${R("body")}
          		}`;else G+=`if(validator.body.Check(c.body) === false) {
         			${R("body")}
          		}`;if(N)G+="\nif(isNotEmptyObject) c.body = validator.body.Decode(c.body)\n"}if(p(L?.schema?.properties??L?.schema?.schema??{})){if(G+=`const cookieValue = {}
    			for(const [key, value] of Object.entries(c.cookie))
    				cookieValue[key] = value.value\n`,C0("default",L.schema))for(let[N,_]of Object.entries(n0.Default(L.schema,{})))G+=`cookieValue['${N}'] = ${typeof _==="object"?JSON.stringify(_):_}\n`;if(n(J.cookie))G+="if(isNotEmpty(c.cookie)) {";if(G+=`if(validator.cookie.Check(cookieValue) === false) {
				${R("cookie","cookieValue")}
			}`,S0(J.cookie.schema))G+=`\nfor(const [key, value] of Object.entries(validator.cookie.Decode(cookieValue)))
					c.cookie[key].value = value\n`;if(n(J.cookie))G+="}"}}if(j?.beforeHandle){const N=b("beforeHandle",{total:j.beforeHandle.length});let _=!1;for(let P=0;P<j.beforeHandle.length;P++){const C=j.beforeHandle[P],S=N.resolveChild(C.fn.name),s=H0(C);if(C.subType==="resolve"||C.subType==="mapResolve"){if(!_)_=!0,G+="\nlet resolved\n";if(G+=g(C)?`resolved = await beforeHandle[${P}](c);\n`:`resolved = beforeHandle[${P}](c);\n`,C.subType==="mapResolve")G+=`if(resolved[ELYSIA_RESPONSE])
						throw resolved
					else {
						resolved.request = c.request
						resolved.store = c.store
						resolved.qi = c.qi
						resolved.path = c.path
						resolved.url = c.url
						resolved.redirect = c.redirect
						resolved.set = c.set
						resolved.error = c.error

						c = resolved
					}`;else G+=`if(resolved[ELYSIA_RESPONSE])
						throw resolved
					else
						Object.assign(c, resolved)\n`}else if(!s)G+=g(C)?`await beforeHandle[${P}](c);\n`:`beforeHandle[${P}](c);\n`,S();else{if(G+=g(C)?`be = await beforeHandle[${P}](c);\n`:`be = beforeHandle[${P}](c);\n`,S("be"),G+="if(be !== undefined) {\n",N.resolve(),j.afterHandle?.length){b("handle",{name:B?Q.name:void 0}).resolve();const u=b("afterHandle",{total:j.afterHandle.length});for(let j0=0;j0<j.afterHandle.length;j0++){const q0=j.afterHandle[j0],V2=H0(q0),A2=u.resolveChild(q0.fn.name);if(G+="c.response = be\n",!V2)G+=g(q0.fn)?`await afterHandle[${j0}](c, be)\n`:`afterHandle[${j0}](c, be)\n`;else G+=g(q0.fn)?`af = await afterHandle[${j0}](c)\n`:`af = afterHandle[${j0}](c)\n`,G+="if(af !== undefined) { c.response = be = af }\n";A2("af")}u.resolve()}if(J.response)G+=F0("be");const U0=b("mapResponse",{total:j.mapResponse.length});if(j.mapResponse.length){G+="\nc.response = be\n";for(let u=0;u<j.mapResponse.length;u++){const j0=j.mapResponse[u],q0=U0.resolveChild(j0.fn.name);G+=`\nif(mr === undefined) {
							mr = ${L0(j0)?"await":""} onMapResponse[${u}](c)
							if(mr !== undefined) be = c.response = mr
						}\n`,q0()}}U0.resolve(),G+=E,G+=`return mapEarlyResponse(${a} be, c.set ${t})}\n`}}N.resolve()}if(j?.afterHandle.length){const N=b("handle",{name:B?Q.name:void 0});if(j.afterHandle.length)G+=J0?`let r = c.response = await ${K};\n`:`let r = c.response = ${K};\n`;else G+=J0?`let r = await ${K};\n`:`let r = ${K};\n`;N.resolve();const _=b("afterHandle",{total:j.afterHandle.length});for(let C=0;C<j.afterHandle.length;C++){const S=j.afterHandle[C],s=H0(S),H=_.resolveChild(S.fn.name);if(!s)G+=g(S.fn)?`await afterHandle[${C}](c)\n`:`afterHandle[${C}](c)\n`,H();else if(G+=g(S.fn)?`af = await afterHandle[${C}](c)\n`:`af = afterHandle[${C}](c)\n`,H("af"),J.response)G+="if(af !== undefined) {",_.resolve(),G+=F0("af"),G+="c.response = af }";else G+="if(af !== undefined) {",_.resolve(),G+="c.response = af}\n"}if(_.resolve(),G+="r = c.response\n",J.response)G+=F0();G+=E;const P=b("mapResponse",{total:j.mapResponse.length});if(j.mapResponse.length)for(let C=0;C<j.mapResponse.length;C++){const S=j.mapResponse[C],s=P.resolveChild(S.fn.name);G+=`\nmr = ${L0(S)?"await":""} onMapResponse[${C}](c)
				if(mr !== undefined) r = c.response = mr\n`,s()}if(P.resolve(),t0)G+=`return mapResponse(${a} r, c.set ${t})\n`;else G+=`return mapCompactResponse(${a} r ${t})\n`}else{const N=b("handle",{name:B?Q.name:void 0});if(J.response||j.mapResponse.length){if(G+=J0?`let r = await ${K};\n`:`let r = ${K};\n`,N.resolve(),J.response)G+=F0();b("afterHandle").resolve();const _=b("mapResponse",{total:j.mapResponse.length});if(j.mapResponse.length){G+="\nc.response = r\n";for(let P=0;P<j.mapResponse.length;P++){const C=j.mapResponse[P],S=_.resolveChild(C.fn.name);G+=`\nif(mr === undefined) {
						mr = ${L0(C)?"await":""} onMapResponse[${P}](c)
    					if(mr !== undefined) r = c.response = mr
					}\n`,S()}}if(_.resolve(),G+=E,Q instanceof Response)G+=U.set?`if(
					isNotEmpty(c.set.headers) ||
					c.set.status !== 200 ||
					c.set.redirect ||
					c.set.cookie
				)
					return mapResponse(${a} ${K}.clone(), c.set ${t})
				else
					return ${K}.clone()`:`return ${K}.clone()`,G+="\n";else if(t0)G+=`return mapResponse(${a} r, c.set ${t})\n`;else G+=`return mapCompactResponse(${a} r ${t})\n`}else if(A||F){G+=J0?`let r = await ${K};\n`:`let r = ${K};\n`,N.resolve(),b("afterHandle").resolve();const _=b("mapResponse",{total:j.mapResponse.length});if(j.mapResponse.length){G+="\nc.response = r\n";for(let P=0;P<j.mapResponse.length;P++){const C=j.mapResponse[P],S=_.resolveChild(C.fn.name);G+=`\nif(mr === undefined) {
							mr = ${L0(C)?"await":""} onMapResponse[${P}](c)
    						if(mr !== undefined) r = c.response = mr
						}\n`,S()}}if(_.resolve(),G+=E,t0)G+=`return mapResponse(${a} r, c.set ${t})\n`;else G+=`return mapCompactResponse(${a} r ${t})\n`}else{N.resolve();const _=J0?`await ${K}`:K;if(b("afterHandle").resolve(),Q instanceof Response)G+=U.set?`if(
					isNotEmpty(c.set.headers) ||
					c.set.status !== 200 ||
					c.set.redirect ||
					c.set.cookie
				)
					return mapResponse(${a} ${K}.clone(), c.set ${t})
				else
					return ${K}.clone()`:`return ${K}.clone()`,G+="\n";else if(t0)G+=`return mapResponse(${a} ${_}, c.set ${t})\n`;else G+=`return mapCompactResponse(${a} ${_} ${t})\n`}}if(G+="\n} catch(error) {",D)G+="\nif(isParsing) error = new ParseError()\n";if(!y0)G+="\nreturn (async () => {\n";if(G+="\nconst set = c.set\nif (!set.status || set.status < 300) set.status = error?.status || 500\n",F)for(let N=0;N<j.trace.length;N++)G+=`report${N}?.resolve(error);reportChild${N}?.(error);\n`;const K1=b("error",{total:j.error.length});if(j.error.length){G+=`
				c.error = error
				c.code = error.code ?? error[ERROR_CODE] ?? "UNKNOWN"
				let er
			`;for(let N=0;N<j.error.length;N++){const _=K1.resolveChild(j.error[N].fn.name);if(g(j.error[N]))G+=`\ner = await handleErrors[${N}](c)\n`;else G+=`\ner = handleErrors[${N}](c)\nif (er instanceof Promise) er = await er\n`;_();const P=b("mapResponse",{total:j.mapResponse.length});if(j.mapResponse.length)for(let C=0;C<j.mapResponse.length;C++){const S=j.mapResponse[C],s=P.resolveChild(S.fn.name);G+=`\nc.response = er\n
							er = ${L0(S)?"await":""} onMapResponse[${C}](c)
							if(er instanceof Promise) er = await er\n`,s()}if(P.resolve(),G+=`er = mapEarlyResponse(er, set ${t})\n`,G+="if (er) {",F){for(let C=0;C<j.trace.length;C++)G+=`\nreport${C}.resolve()\n`;K1.resolve()}G+="return er\n}\n"}}if(K1.resolve(),G+="return handleError(c, error, true)\n",!y0)G+="})()";if(G+="}",w||F){if(G+=" finally { ",!y0)G+=";(async () => {";const N=b("afterResponse",{total:j.afterResponse.length});if(w)for(let _=0;_<j.afterResponse.length;_++){const P=N.resolveChild(j.afterResponse[_].fn.name);G+=`\nawait afterResponse[${_}](c);\n`,P()}if(N.resolve(),!y0)G+="})();";G+="}"}G=`const {
		handler,
		handleError,
		hooks: {
			transform,
			resolve,
			beforeHandle,
			afterHandle,
			mapResponse: onMapResponse,
			parse,
			error: handleErrors,
			afterResponse,
			trace: _trace
		},
		validator,
		utils: {
			mapResponse,
			mapCompactResponse,
			mapEarlyResponse,
			parseQuery,
			parseQueryFromURL,
			isNotEmpty
		},
		error: {
			NotFoundError,
			ValidationError,
			InternalServerError,
			ParseError
		},
		schema,
		definitions,
		ERROR_CODE,
		parseCookie,
		signCookie,
		decodeURIComponent,
		ELYSIA_RESPONSE,
		ELYSIA_TRACE,
		ELYSIA_REQUEST_ID,
		getServer
	} = hooks

	const trace = _trace.map(x => typeof x === 'function' ? x : x.fn)

	return ${y0?"async":""} function handle(c) {
		${j.beforeHandle.length?"let be":""}
		${j.afterHandle.length?"let af":""}
		${j.mapResponse.length?"let mr":""}

		${Y?"c.schema = schema; c.defs = definitions":""}
		${G}
	}`;try{return Function("hooks",G)({handler:Q,hooks:S1(j),validator:J,handleError:$.handleError,utils:{mapResponse:f,mapCompactResponse:$0,mapEarlyResponse:y,parseQuery:p0,parseQueryFromURL:B1,isNotEmpty:p},error:{NotFoundError:A0,ValidationError:T,InternalServerError:G1,ParseError:Y1},schema:$.router.history,definitions:$.definitions.type,ERROR_CODE:V0,parseCookie:e0,signCookie:x0,decodeURIComponent:M2.default,ELYSIA_RESPONSE:d,ELYSIA_TRACE:i0,ELYSIA_REQUEST_ID:I0,getServer:()=>$.getServer()})}catch{const N=S1(j);console.log("[Composer] failed to generate optimized handler"),console.log("Please report the following to SaltyAom privately as it may include sensitive information about your codebase:"),console.log("---"),console.log({handler:typeof Q==="function"?Q.toString():Q,hooks:{...N,transform:N?.transform?.map?.((_)=>_.toString()),resolve:N?.resolve?.map?.((_)=>_.toString()),beforeHandle:N?.beforeHandle?.map?.((_)=>_.toString()),afterHandle:N?.afterHandle?.map?.((_)=>_.toString()),mapResponse:N?.mapResponse?.map?.((_)=>_.toString()),parse:N?.parse?.map?.((_)=>_.toString()),error:N?.error?.map?.((_)=>_.toString()),afterResponse:N?.afterResponse?.map?.((_)=>_.toString()),stop:N?.stop?.map?.((_)=>_.toString())},validator:J,definitions:$.definitions.type}),console.log("---"),process.exit(1)}},R1=($)=>{const W=$.config.handler?.standardHostname??!0;let X="",Z="";const j=$.setHeaders;for(let D of Object.keys($.singleton.decorator))X+=`,${D}: app.singleton.decorator.${D}`;const J=$.router,Q=$.event.trace.length>0;let Y=`
	const route = router.find(request.method, path) ${J.http.root.ALL?'?? router.find("ALL", path)':""}

	if (route === null)
		return ${$.event.error.length?"app.handleError(ctx, notFound)":$.event.request.length?`new Response(error404Message, {
					status: ctx.set.status === 200 ? 404 : ctx.set.status,
					headers: ctx.set.headers
				})`:"error404.clone()"}

	ctx.params = route.params\n`;Y+=`if(route.store.handler) return route.store.handler(ctx)
	return (route.store.handler = route.store.compile())(ctx)\n`;let U="";for(let[D,{code:z,all:I}]of Object.entries(J.static.http.map))U+=`case '${D}':\nswitch(request.method) {\n${z}\n${I??"default: break map"}}\n\n`;const B=$.event.request.some(g);if(Z+=`const {
		app,
		mapEarlyResponse,
		NotFoundError,
		randomId,
		handleError,
		error,
		redirect,
		ELYSIA_TRACE,
		ELYSIA_REQUEST_ID,
		getServer
	} = data

	const store = app.singleton.store
	const staticRouter = app.router.static.http
	const st = staticRouter.handlers
	const wsRouter = app.router.ws
	const router = app.router.http
	const trace = app.event.trace.map(x => typeof x === 'function' ? x : x.fn)

	const notFound = new NotFoundError()
	const hoc = app.extender.higherOrderFunctions.map(x => x.fn)

	${$.event.request.length?"const onRequest = app.event.request.map(x => x.fn)":""}
	${$.event.error.length?"":`\nconst error404Message = notFound.message.toString()
	const error404 = new Response(error404Message, { status: 404 });\n`}

	${$.event.trace.length?`const ${$.event.trace.map((D,z)=>`tr${z} = app.event.trace[${z}].fn`).join(",")}`:""}

	${B?"async":""} function map(request) {\n`,$.event.request.length)Z+="let re";if(Z+=`\nconst url = request.url
		const s = url.indexOf('/', ${W?11:7})
		const qi = url.indexOf('?', s + 1)
		let path
		if(qi === -1)
			path = url.substring(s)
		else
			path = url.substring(s, qi)\n`,Z+=`${Q?"const id = randomId()":""}
		const ctx = {
			request,
			store,
			qi,
			path,
			url,
			redirect,
			set: {
				headers: ${Object.keys(j??{}).length?"Object.assign({}, app.setHeaders)":"{}"},
				status: 200
			},
			error
			${$.inference.server?`, get server() {
							return getServer()
						}`:""}
			${Q?",[ELYSIA_REQUEST_ID]: id":""}
			${X}
		}\n`,$.event.trace.length)Z+=`\nctx[ELYSIA_TRACE] = [${$.event.trace.map((D,z)=>`tr${z}(ctx)`).join(",")}]\n`;const w=E1({context:"ctx",trace:$.event.trace,addFn:(D)=>{Z+=D}})("request",{attribute:"ctx",total:$.event.request.length});if($.event.request.length){Z+="\n try {\n";for(let D=0;D<$.event.request.length;D++){const z=$.event.request[D],I=H0(z),V=g(z),A=w.resolveChild($.event.request[D].fn.name);if(I)Z+=`re = mapEarlyResponse(
					${V?"await":""} onRequest[${D}](ctx),
					ctx.set,
					request
				)\n`,A("re"),Z+="if(re !== undefined) return re\n";else Z+=`${V?"await":""} onRequest[${D}](ctx)\n`,A()}Z+=`} catch (error) {
			return app.handleError(ctx, error)
		}`}w.resolve();const F=$.router.static.ws,G=$.router.ws;if(Object.keys(F).length||G.history.length){Z+=`
			if(request.method === 'GET') {
				switch(path) {`;for(let[D,z]of Object.entries(F))Z+=`
					case '${D}':
						if(request.headers.get('upgrade') === 'websocket')
							return st[${z}](ctx)

						break`;Z+=`
				default:
					if(request.headers.get('upgrade') === 'websocket') {
						const route = wsRouter.find('ws', path)

						if(route) {
							ctx.params = route.params

							if(route.store.handler)
							    return route.store.handler(ctx)

							return (route.store.handler = route.store.compile())(ctx)
						}
					}

					break
			}
		}\n`}if(Z+=`
		map: switch(path) {
			${U}

			default:
				break
		}

		${Y}
	}\n`,$.extender.higherOrderFunctions.length){let D="map";for(let z=0;z<$.extender.higherOrderFunctions.length;z++)D=`hoc[${z}](${D}, request)`;Z+=`return function hocMap(request) { return ${D}(request) }`}else Z+="return map";const M=b1($);return $.handleError=M,Function("data",Z)({app:$,mapEarlyResponse:y,NotFoundError:A0,randomId:j1,handleError:M,error:L1,redirect:d0,ELYSIA_TRACE:i0,ELYSIA_REQUEST_ID:I0,getServer:()=>$.getServer()})},b1=($)=>{const W=$.event;let X="";X+=`const {
		app: { event: { error: onErrorContainer, afterResponse: resContainer, mapResponse: _onMapResponse, trace: _trace } },
		mapResponse,
		ERROR_CODE,
		ELYSIA_RESPONSE,
		ELYSIA_TRACE,
		ELYSIA_REQUEST_ID
	} = inject

	const trace = _trace.map(x => typeof x === 'function' ? x : x.fn)
	const onMapResponse = []

	for(let i = 0; i < _onMapResponse.length; i++)
		onMapResponse.push(_onMapResponse[i].fn ?? _onMapResponse[i])

	delete _onMapResponse

	const onError = onErrorContainer.map(x => x.fn)
	const res = resContainer.map(x => x.fn)

	return ${$.event.error.find(g)||$.event.mapResponse.find(g)?"async":""} function(context, error, skipGlobal) {`;const Z=$.event.trace.length>0;if(Z)X+="\nconst id = context[ELYSIA_REQUEST_ID]\n";const j=E1({context:"context",trace:W.trace,addFn:(Y)=>{X+=Y}});X+=`
		const set = context.set
		let r

		if(!context.code)
			context.code = error.code ?? error[ERROR_CODE]

		if(!(context.error instanceof Error))
			context.error = error

		if(typeof error === "object" && error && ELYSIA_RESPONSE in error) {
			error.status = error[ELYSIA_RESPONSE]
			error.message = error.response
		}\n`;const J=Z||W.afterResponse.length>0||W.afterResponse.length>0?"context.response = ":"";for(let Y=0;Y<$.event.error.length;Y++){const U=$.event.error[Y],B=`${g(U)?"await ":""}onError[${Y}](context)`;if(X+="\nif(skipGlobal !== true) {\n",H0(U)){X+=`r = ${B}; if(r !== undefined) {
				if(r instanceof Response) return r

				if(r[ELYSIA_RESPONSE]) {
					error.status = error[ELYSIA_RESPONSE]
					error.message = error.response
				}

				if(set.status === 200) set.status = error.status\n`;const K=j("mapResponse",{total:W.mapResponse.length,name:"context"});if(W.mapResponse.length)for(let w=0;w<W.mapResponse.length;w++){const F=W.mapResponse[w],G=K.resolveChild(F.fn.name);X+=`\ncontext.response = r
						r = ${L0(F)?"await":""} onMapResponse[${w}](context)\n`,G()}K.resolve(),X+=`return mapResponse(${J} r, set, context.request)}\n`}else X+=B+"\n";X+="\n}\n"}X+=`if(error.constructor.name === "ValidationError" || error.constructor.name === "TransformDecodeError") {
		set.status = error.status ?? 422
		return new Response(
			error.message,
			{
				headers: Object.assign(
					{ 'content-type': 'application/json'},
					set.headers
				),
				status: set.status
			}
		)
	} else {
		if(error.code && typeof error.status === "number")
			return new Response(
				error.message,
				{ headers: set.headers, status: error.status }
			)\n`;const Q=j("mapResponse",{total:W.mapResponse.length,name:"context"});if(W.mapResponse.length)for(let Y=0;Y<W.mapResponse.length;Y++){const U=W.mapResponse[Y],B=Q.resolveChild(U.fn.name);X+=`\ncontext.response = error
			error = ${L0(U)?"await":""} onMapResponse[${Y}](context)\n`,B()}return Q.resolve(),X+=`\nreturn mapResponse(${J} error, set, context.request)\n}\n}`,Function("inject",X)({app:$,mapResponse:f,ERROR_CODE:V0,ELYSIA_RESPONSE:d,ELYSIA_TRACE:i0,ELYSIA_REQUEST_ID:I0})};var x1=($)=>async(W)=>{const X=W.url,Z=X.indexOf("/",11),j=X.indexOf("?",Z+1),J=j===-1?X.substring(Z):X.substring(Z,j),Q={cookie:{},status:200,headers:{}},Y=Object.assign({},$.singleton.decorator,{set:Q,store:$.singleton.store,request:W,path:J,qi:j,redirect:d0});try{for(let I=0;I<$.event.request.length;I++){const V=$.event.request[I].fn;let A=V(Y);if(A instanceof Promise)A=await A;if(A=y(A,Q),A)return Y.response=A}const U=$.router.dynamic.find(W.method,J)??$.router.dynamic.find("ALL",J);if(!U)throw new A0;const{handle:B,hooks:K,validator:w,content:F}=U.store;let G;if(W.method!=="GET"&&W.method!=="HEAD")if(F)switch(F){case"application/json":G=await W.json();break;case"text/plain":G=await W.text();break;case"application/x-www-form-urlencoded":G=p0(await W.text());break;case"application/octet-stream":G=await W.arrayBuffer();break;case"multipart/form-data":G={};const I=await W.formData();for(let V of I.keys()){if(G[V])continue;const A=I.getAll(V);if(A.length===1)G[V]=A[0];else G[V]=A}break}else{let I=W.headers.get("content-type");if(I){const V=I.indexOf(";");if(V!==-1)I=I.slice(0,V);Y.contentType=I;for(let A=0;A<K.parse.length;A++){const L=K.parse[A].fn;let q=L(Y,I);if(q instanceof Promise)q=await q;if(q){G=q;break}}if(delete Y.contentType,G===void 0)switch(I){case"application/json":G=await W.json();break;case"text/plain":G=await W.text();break;case"application/x-www-form-urlencoded":G=p0(await W.text());break;case"application/octet-stream":G=await W.arrayBuffer();break;case"multipart/form-data":G={};const A=await W.formData();for(let L of A.keys()){if(G[L])continue;const q=A.getAll(L);if(q.length===1)G[L]=q[0];else G[L]=q}break}}}Y.body=G,Y.params=U?.params||void 0,Y.query=j===-1?{}:B1(X.substring(j+1)),Y.headers={};for(let[I,V]of W.headers.entries())Y.headers[I]=V;const M=Object.assign({},$.config?.cookie,w?.cookie?.config),D=W.headers.get("cookie");Y.cookie=await e0(Y.set,D,M?{secrets:M.secrets!==void 0?typeof M.secrets==="string"?M.secrets:M.secrets.join(","):void 0,sign:M.sign===!0?!0:M.sign!==void 0?typeof M.sign==="string"?M.sign:M.sign.join(","):void 0}:void 0);for(let I=0;I<K.transform.length;I++){const V=K.transform[I],A=V.fn(Y);if(V.subType==="derive")if(A instanceof Promise)Object.assign(Y,await A);else Object.assign(Y,A);else if(A instanceof Promise)await A}if(w){if(w.createHeaders?.()){const I={};for(let V in W.headers)I[V]=W.headers.get(V);if(w.headers.Check(I)===!1)throw new T("header",w.headers,I)}if(w.createParams?.()?.Check(Y.params)===!1)throw new T("params",w.params,Y.params);if(w.createQuery?.()?.Check(Y.query)===!1)throw new T("query",w.query,Y.query);if(w.createCookie?.()){const I={};for(let[V,A]of Object.entries(Y.cookie))I[V]=A.value;if(w.cookie.Check(I)===!1)throw new T("cookie",w.cookie,I)}if(w.createBody?.()?.Check(G)===!1)throw new T("body",w.body,G)}for(let I=0;I<K.beforeHandle.length;I++){let V=K.beforeHandle[I].fn(Y);if(V instanceof Promise)V=await V;if(V!==void 0){Y.response=V;for(let L=0;L<K.afterHandle.length;L++){let q=K.afterHandle[L].fn(Y);if(q instanceof Promise)q=await q;if(q)V=q}const A=y(V,Y.set);if(A)return Y.response=A}}let z=B(Y);if(z instanceof Promise)z=await z;if(!K.afterHandle.length){const I=z?.[d]??(Q.status?typeof Q.status==="string"?w0[Q.status]:Q.status:200),V=w?.createResponse?.()?.[I];if(V?.Check(z)===!1)throw new T("response",V,z)}else{Y.response=z;for(let I=0;I<K.afterHandle.length;I++){let V=K.afterHandle[I].fn(Y);if(V instanceof Promise)V=await V;const A=y(V,Y.set);if(A!==void 0){const L=w?.response?.[A.status];if(L?.Check(A)===!1)throw new T("response",L,A);return Y.response=A}}}if(Y.set.cookie&&M?.sign){const I=!M.secrets?void 0:typeof M.secrets==="string"?M.secrets:M.secrets[0];if(M.sign===!0)for(let[V,A]of Object.entries(Y.set.cookie))Y.set.cookie[V].value=await x0(A.value,"${secret}");else{const V=w?.cookie?.schema?.properties;for(let A of M.sign){if(!(A in V))continue;if(Y.set.cookie[A]?.value)Y.set.cookie[A].value=await x0(Y.set.cookie[A].value,I)}}}return Y.response=f(z,Y.set)}catch(U){if(U.status)Q.status=U.status;return $.handleError(Y,U)}finally{for(let U of $.event.afterResponse)await U.fn(Y)}},N2=($)=>async(W,X)=>{const Z=Object.assign(W,{error:X,code:X.code});Z.set=W.set;for(let j=0;j<$.event.error.length;j++){let Q=$.event.error[j].fn(Z);if(Q instanceof Promise)Q=await Q;if(Q!==void 0&&Q!==null)return W.response=f(Q,W.set)}return new Response(typeof X.cause==="string"?X.cause:X.message,{headers:W.set.headers,status:X.status??500})};class Z0{config;server=null;dependencies={};_routes={};_types={Prefix:"",Scoped:!1,Singleton:{},Definitions:{},Metadata:{}};_ephemeral={};_volatile={};static version=T1;version=T1;singleton={decorator:{},store:{},derive:{},resolve:{}};get store(){return this.singleton.store}get decorator(){return this.singleton.decorator}get _scoped(){return this.config.scoped}definitions={type:{},error:{}};extender={macros:[],higherOrderFunctions:[]};validator={global:null,scoped:null,local:null,getCandidate(){return b0(b0(this.global,this.scoped),this.local)}};event={start:[],request:[],parse:[],transform:[],beforeHandle:[],afterHandle:[],mapResponse:[],afterResponse:[],trace:[],error:[],stop:[]};telemetry={stack:void 0};router={http:new M0,ws:new M0,dynamic:new M0,static:{http:{handlers:[],map:{},all:""},ws:{}},history:[]};routeTree=new Map;get routes(){return this.router.history}getGlobalRoutes(){return this.router.history}inference={body:!1,cookie:!1,headers:!1,query:!1,set:!1,server:!1};getServer(){return this.server}_promisedModules;get promisedModules(){if(!this._promisedModules)this._promisedModules=new C1;return this._promisedModules}constructor($){if($?.tags)if(!$.detail)$.detail={tags:$.tags};else $.detail.tags=$.tags;if(this.config={},this.applyConfig($??{}),$?.analytic&&($?.name||$?.seed!==void 0))this.telemetry.stack=new Error().stack}env($,W=Bun?.env??process.env){if(m($,{dynamic:!0,additionalProperties:!0,coerce:!0}).Check(W)===!1){const Z=new T("env",$,W);throw new Error(Z.all.map((j)=>j.summary).join("\n"))}return this}wrap($){return this.extender.higherOrderFunctions.push({checksum:P0(JSON.stringify({name:this.config.name,seed:this.config.seed,content:$.toString()})),fn:$}),this}applyMacro($){if(this.extender.macros.length){const W=K2({globalHook:this.event,localHook:$}),X={events:{global:this.event,local:$},onParse:W("parse"),onTransform:W("transform"),onBeforeHandle:W("beforeHandle"),onAfterHandle:W("afterHandle"),mapResponse:W("mapResponse"),onAfterResponse:W("afterResponse"),onError:W("error")};for(let Z of this.extender.macros)U2(Z.fn(X),$)}}applyConfig($){return this.config={prefix:"",aot:!0,strictPath:!1,global:!1,analytic:!1,normalize:!0,...$,cookie:{path:"/",...$?.cookie},experimental:$?.experimental??{},seed:$?.seed===void 0?"":$?.seed},this}get models(){const $={};for(let[W,X]of Object.entries(this.definitions.type))$[W]=m(X);return $}add($,W,X,Z,{allowMeta:j=!1,skipPrefix:J=!1}={allowMeta:!1,skipPrefix:!1}){if(Z=w2(Z),W!==""&&W.charCodeAt(0)!==47)W="/"+W;if(this.config.prefix&&!J&&!this.config.scoped)W=this.config.prefix+W;if(Z?.type)switch(Z.type){case"text":Z.type="text/plain";break;case"json":Z.type="application/json";break;case"formdata":Z.type="multipart/form-data";break;case"urlencoded":Z.type="application/x-www-form-urlencoded";break;case"arrayBuffer":Z.type="application/octet-stream";break;default:break}const Q=this.definitions.type,Y=!this.config.aot,U={...this.validator.getCandidate()},B={body:Z?.body??U?.body,headers:Z?.headers??U?.headers,params:Z?.params??U?.params,query:Z?.query??U?.query,cookie:Z?.cookie??U?.cookie,response:Z?.response??U?.response},K=()=>B.cookie?X1({validator:B.cookie,defaultConfig:this.config.cookie,config:B.cookie?.config??{},dynamic:Y,models:Q}):void 0,w=this.config.normalize,F=this.config.precompile===!0||typeof this.config.precompile==="object"&&this.config.precompile.schema===!0?{body:m(B.body,{dynamic:Y,models:Q,normalize:w}),headers:m(B.headers,{dynamic:Y,models:Q,additionalProperties:!this.config.normalize,coerce:!0,additionalCoerce:D0()}),params:m(B.params,{dynamic:Y,models:Q,coerce:!0,additionalCoerce:D0()}),query:m(B.query,{dynamic:Y,models:Q,normalize:w,coerce:!0,additionalCoerce:D0()}),cookie:K(),response:W1(B.response,{dynamic:Y,models:Q,normalize:w})}:{createBody(){if(this.body)return this.body;return this.body=m(B.body,{dynamic:Y,models:Q,normalize:w})},createHeaders(){if(this.headers)return this.headers;return this.headers=m(B.headers,{dynamic:Y,models:Q,additionalProperties:!w,coerce:!0,additionalCoerce:D0()})},createParams(){if(this.params)return this.params;return this.params=m(B.params,{dynamic:Y,models:Q,coerce:!0,additionalCoerce:D0()})},createQuery(){if(this.query)return this.query;return this.query=m(B.query,{dynamic:Y,models:Q,coerce:!0,additionalCoerce:D0()})},createCookie(){if(this.cookie)return this.cookie;return this.cookie=K()},createResponse(){if(this.response)return this.response;return this.response=W1(B.response,{dynamic:Y,models:Q,normalize:w})}},G=W.endsWith("/")?W.slice(0,W.length-1):W+"/";if(Z=l(Z,U),Z.tags)if(!Z.detail)Z.detail={tags:Z.tags};else Z.detail.tags=Z.tags;if(p(this.config.detail))Z.detail=c(Object.assign({},this.config.detail),Z.detail);this.applyMacro(Z);const M=l(this.event,Z);if(this.config.aot===!1){if(this.router.dynamic.add($,W,{validator:F,hooks:M,content:Z?.type,handle:X}),this.config.strictPath===!1)this.router.dynamic.add($,G,{validator:F,hooks:M,content:Z?.type,handle:X});this.router.history.push({method:$,path:W,composed:null,handler:X,hooks:M});return}const D=this.config.precompile===!0||typeof this.config.precompile==="object"&&this.config.precompile.compose===!0,z=m0(this.inference),I=()=>D2({app:this,path:W,method:$,localHook:l(Z),hooks:M,validator:F,handler:X,allowMeta:j,inference:z}),V=D?I():(E)=>{return I()(E)},A=this.router.history.length;if(this.routeTree.has($+W))for(let E=0;E<this.router.history.length;E++){const v=this.router.history[E];if(v.path===W&&v.method===$){const R=this.router.history.splice(E,1)[0];if(R&&this.routeTree.has(R?.method+R?.path))this.routeTree.delete(R.method+R.path)}}else this.routeTree.set($+W,A);this.router.history.push({method:$,path:W,composed:V,handler:X,hooks:M});const L=this.router.static.http,q={handler:D?V:void 0,compile:I};if($==="$INTERNALWS"){const E=this.config.strictPath?void 0:W.endsWith("/")?W.slice(0,W.length-1):W+"/";if(W.indexOf(":")===-1&&W.indexOf("*")===-1){const v=L.handlers.length;if(L.handlers.push((R)=>(L.handlers[v]=I())(R)),this.router.static.ws[W]=v,E)this.router.static.ws[E]=v}else if(this.router.ws.add("ws",W,q),E)this.router.ws.add("ws",E,q);return}if(W.indexOf(":")===-1&&W.indexOf("*")===-1){const E=L.handlers.length;if(L.handlers.push((v)=>(L.handlers[E]=I())(v)),!L.map[W])L.map[W]={code:""};if($==="ALL")L.map[W].all=`default: return st[${E}](ctx)\n`;else L.map[W].code=`case '${$}': return st[${E}](ctx)\n${L.map[W].code}`;if(!this.config.strictPath){if(!L.map[G])L.map[G]={code:""};if($==="ALL")L.map[G].all=`default: return st[${E}](ctx)\n`;else L.map[G].code=`case '${$}': return st[${E}](ctx)\n${L.map[G].code}`}}else if(this.router.http.add($,W,q),!this.config.strictPath)this.router.http.add($,W.endsWith("/")?W.slice(0,W.length-1):W+"/",q)}setHeaders;headers($){if(!$)return this;if(!this.setHeaders)this.setHeaders={};return this.setHeaders=c(this.setHeaders,$),this}onStart($){return this.on("start",$),this}onRequest($){return this.on("request",$),this}onParse($,W){if(!W)return this.on("parse",$);return this.on($,"parse",W)}onTransform($,W){if(!W)return this.on("transform",$);return this.on($,"transform",W)}resolve($,W){if(!W)W=$,$={as:"local"};const X={subType:"resolve",fn:W};return this.onBeforeHandle($,X)}mapResolve($,W){if(!W)W=$,$={as:"local"};const X={subType:"mapResolve",fn:W};return this.onBeforeHandle($,X)}onBeforeHandle($,W){if(!W)return this.on("beforeHandle",$);return this.on($,"beforeHandle",W)}onAfterHandle($,W){if(!W)return this.on("afterHandle",$);return this.on($,"afterHandle",W)}mapResponse($,W){if(!W)return this.on("mapResponse",$);return this.on($,"mapResponse",W)}onAfterResponse($,W){if(!W)return this.on("afterResponse",$);return this.on($,"afterResponse",W)}trace($,W){if(!W)W=$,$={as:"local"};if(!Array.isArray(W))W=[W];for(let X of W)this.on($,"trace",F2(X));return this}error($,W){switch(typeof $){case"string":return W.prototype[V0]=$,this.definitions.error[$]=W,this;case"function":return this.definitions.error=$(this.definitions.error),this}for(let[X,Z]of Object.entries($))Z.prototype[V0]=X,this.definitions.error[X]=Z;return this}onError($,W){if(!W)return this.on("error",$);return this.on($,"error",W)}onStop($){return this.on("stop",$),this}on($,W,X){let Z;switch(typeof $){case"string":Z=$,X=W;break;case"object":if(Z=W,!Array.isArray(W)&&typeof W==="object")X=W;break}if(Array.isArray(X))X=i(X);else if(typeof X==="function")X=[{fn:X}];else X=[X];const j=X;for(let J of j)J.scope=typeof $==="string"?"local":$?.as??"local";if(Z!=="trace")s0({[Z]:j.map((J)=>J.fn)},this.inference);for(let J of j){const Q=B2(J,"global",{skipIfHasType:!0});switch(Z){case"start":this.event.start.push(Q);break;case"request":this.event.request.push(Q);break;case"parse":this.event.parse.push(Q);break;case"transform":this.event.transform.push(Q);break;case"beforeHandle":this.event.beforeHandle.push(Q);break;case"afterHandle":this.event.afterHandle.push(Q);break;case"mapResponse":this.event.mapResponse.push(Q);break;case"afterResponse":this.event.afterResponse.push(Q);break;case"trace":this.event.trace.push(Q);break;case"error":this.event.error.push(Q);break;case"stop":this.event.stop.push(Q);break}}return this}propagate(){return k(this.event.parse),k(this.event.transform),k(this.event.beforeHandle),k(this.event.afterHandle),k(this.event.mapResponse),k(this.event.afterResponse),k(this.event.trace),k(this.event.error),this}as($){const W={plugin:"scoped",global:"global"}[$];if(k(this.event.parse,W),k(this.event.transform,W),k(this.event.beforeHandle,W),k(this.event.afterHandle,W),k(this.event.mapResponse,W),k(this.event.afterResponse,W),k(this.event.trace,W),k(this.event.error,W),$==="plugin")this.validator.scoped=b0(this.validator.scoped,this.validator.local),this.validator.local=null;else if($==="global")this.validator.global=b0(this.validator.global,b0(this.validator.scoped,this.validator.local)),this.validator.scoped=null,this.validator.local=null;return this}group($,W,X){const Z=new Z0({...this.config,prefix:""});Z.singleton={...this.singleton},Z.definitions={...this.definitions},Z.getServer=()=>this.getServer(),Z.inference=m0(this.inference),Z.extender={...this.extender};const j=typeof W==="object",J=(j?X:W)(Z);if(this.singleton=c(this.singleton,Z.singleton),this.definitions=c(this.definitions,Z.definitions),J.event.request.length)this.event.request=[...this.event.request||[],...J.event.request||[]];if(J.event.mapResponse.length)this.event.mapResponse=[...this.event.mapResponse||[],...J.event.mapResponse||[]];return this.model(J.definitions.type),Object.values(Z.router.history).forEach(({method:Q,path:Y,handler:U,hooks:B})=>{if(Y=(j?"":this.config.prefix)+$+Y,j){const K=W,w=B;this.add(Q,Y,U,l(K,{...w||{},error:!w.error?J.event.error:Array.isArray(w.error)?[...w.error||{},...J.event.error||{}]:[w.error,...J.event.error||{}]}))}else this.add(Q,Y,U,l(B,{error:J.event.error}),{skipPrefix:!0})}),this}guard($,W){if(!W){if(typeof $==="object"){this.applyMacro($);const j=$.as??"local";if(this.validator[j]={body:$.body??this.validator[j]?.body,headers:$.headers??this.validator[j]?.headers,params:$.params??this.validator[j]?.params,query:$.query??this.validator[j]?.query,response:$.response??this.validator[j]?.response,cookie:$.cookie??this.validator[j]?.cookie},$.parse)this.on({as:j},"parse",$.parse);if($.transform)this.on({as:j},"transform",$.transform);if($.beforeHandle)this.on({as:j},"beforeHandle",$.beforeHandle);if($.afterHandle)this.on({as:j},"afterHandle",$.afterHandle);if($.mapResponse)this.on({as:j},"mapResponse",$.mapResponse);if($.afterResponse)this.on({as:j},"afterResponse",$.afterResponse);if($.error)this.on({as:j},"error",$.error);if($.detail)if(this.config.detail)this.config.detail=c(Object.assign({},this.config.detail),$.detail);else this.config.detail=$.detail;if($?.tags)if(!this.config.detail)this.config.detail={tags:$.tags};else this.config.detail.tags=$.tags;return this}return this.guard({},$)}const X=new Z0({...this.config,prefix:""});X.singleton={...this.singleton},X.definitions={...this.definitions},X.inference=m0(this.inference),X.extender={...this.extender};const Z=W(X);if(this.singleton=c(this.singleton,X.singleton),this.definitions=c(this.definitions,X.definitions),Z.getServer=()=>this.server,Z.event.request.length)this.event.request=[...this.event.request||[],...Z.event.request||[]];if(Z.event.mapResponse.length)this.event.mapResponse=[...this.event.mapResponse||[],...Z.event.mapResponse||[]];return this.model(Z.definitions.type),Object.values(X.router.history).forEach(({method:j,path:J,handler:Q,hooks:Y})=>{this.add(j,J,Q,l($,{...Y||{},error:!Y.error?Z.event.error:Array.isArray(Y.error)?[...Y.error||{},...Z.event.error||[]]:[Y.error,...Z.event.error||[]]}))}),this}use($,W){if(W?.scoped)return this.guard({},(X)=>X.use($));if(Array.isArray($)){let X=this;for(let Z of $)X=this.use(Z);return X}if($ instanceof Promise)return this.promisedModules.add($.then((X)=>{if(typeof X==="function")return X(this);if(X instanceof Z0)return this._use(X).compile();if(typeof X.default==="function")return X.default(this);if(X.default instanceof Z0)return this._use(X.default);throw new Error('Invalid plugin type. Expected Elysia instance, function, or module with "default" as Elysia instance or function that returns Elysia instance.')}).then((X)=>X.compile())),this;return this._use($)}_use($){if(typeof $==="function"){const j=$(this);if(j instanceof Promise)return this.promisedModules.add(j.then((J)=>{if(J instanceof Z0){J.getServer=()=>this.getServer(),J.getGlobalRoutes=()=>this.getGlobalRoutes(),J.model(this.definitions.type),J.error(this.definitions.error);for(let{method:Q,path:Y,handler:U,hooks:B}of Object.values(J.router.history))this.add(Q,Y,U,l(B,{error:J.event.error}));return J.compile(),J}if(typeof J==="function")return J(this);if(typeof J.default==="function")return J.default(this);return this._use(J)}).then((J)=>J.compile())),this;return j}const{name:W,seed:X}=$.config;$.getServer=()=>this.getServer(),$.getGlobalRoutes=()=>this.getGlobalRoutes(),$.model(this.definitions.type),$.error(this.definitions.error);const Z=$.config.scoped;if(Z){if(W){if(!(W in this.dependencies))this.dependencies[W]=[];const J=X!==void 0?P0(W+JSON.stringify(X)):0;if(this.dependencies[W].some(({checksum:Q})=>J===Q))return this;this.dependencies[W].push(!this.config?.analytic?{name:$.config.name,seed:$.config.seed,checksum:J,dependencies:$.dependencies}:{name:$.config.name,seed:$.config.seed,checksum:J,dependencies:$.dependencies,stack:$.telemetry.stack,routes:$.router.history,decorators:$.singleton.decorator,store:$.singleton.store,type:$.definitions.type,error:$.definitions.error,derive:$.event.transform.filter((Q)=>Q.subType==="derive").map((Q)=>({fn:Q.fn.toString(),stack:new Error().stack??""})),resolve:$.event.transform.filter((Q)=>Q.subType==="derive").map((Q)=>({fn:Q.fn.toString(),stack:new Error().stack??""}))})}$.extender.macros=this.extender.macros.concat($.extender.macros);const j=[];for(let J=0;J<$.extender.macros.length;J++){const Q=this.extender.macros[J];if(j.includes(Q.checksum))$.extender.macros.splice(J,1),J--;j.push(Q.checksum)}if($.onRequest((J)=>{Object.assign(J,this.singleton.decorator),Object.assign(J.store,this.singleton.store)}),$.event.trace.length)$.event.trace.push(...$.event.trace);if(!$.config.prefix)console.warn("It's recommended to use scoped instance with a prefix to prevent collision routing with other instance.");if($.event.error.length)$.event.error.push(...this.event.error);if($.config.aot)$.compile();if(Z===!0&&$.config.prefix){this.mount($.config.prefix+"/",$.fetch);for(let J of $.router.history)this.routeTree.set(J.method+`${$.config.prefix}${J.path}`,this.router.history.length),this.router.history.push({...J,path:`${$.config.prefix}${J.path}`,hooks:l(J.hooks,{error:this.event.error})})}else{this.mount($.fetch);for(let J of $.router.history)this.routeTree.set(J.method+`${$.config.prefix}${J.path}`,this.router.history.length),this.router.history.push({...J,path:`${$.config.prefix}${J.path}`,hooks:l(J.hooks,{error:this.event.error})})}return this}else{if(this.headers($.setHeaders),W){if(!(W in this.dependencies))this.dependencies[W]=[];const J=X!==void 0?P0(W+JSON.stringify(X)):0;if(!this.dependencies[W].some(({checksum:Q})=>J===Q))this.extender.macros=this.extender.macros.concat($.extender.macros),this.extender.higherOrderFunctions=this.extender.higherOrderFunctions.concat($.extender.higherOrderFunctions)}else this.extender.macros=this.extender.macros.concat($.extender.macros),this.extender.higherOrderFunctions=this.extender.higherOrderFunctions.concat($.extender.higherOrderFunctions);Q1(this.extender.macros),Q1(this.extender.higherOrderFunctions);const j=[];for(let J=0;J<this.extender.higherOrderFunctions.length;J++){const Q=this.extender.higherOrderFunctions[J];if(Q.checksum){if(j.includes(Q.checksum))this.extender.higherOrderFunctions.splice(J,1),J--;j.push(Q.checksum)}}this.inference={body:this.inference.body||$.inference.body,cookie:this.inference.cookie||$.inference.cookie,headers:this.inference.headers||$.inference.headers,query:this.inference.query||$.inference.query,set:this.inference.set||$.inference.set,server:this.inference.server||$.inference.server}}this.decorate($.singleton.decorator),this.state($.singleton.store),this.model($.definitions.type),this.error($.definitions.error),$.extender.macros=this.extender.macros.concat($.extender.macros);for(let{method:j,path:J,handler:Q,hooks:Y}of Object.values($.router.history))this.add(j,J,Q,l(Y,{error:$.event.error}));if(!Z)if(W){if(!(W in this.dependencies))this.dependencies[W]=[];const j=X!==void 0?P0(W+JSON.stringify(X)):0;if(this.dependencies[W].some(({checksum:J})=>j===J))return this;this.dependencies[W].push(!this.config?.analytic?{name:$.config.name,seed:$.config.seed,checksum:j,dependencies:$.dependencies}:{name:$.config.name,seed:$.config.seed,checksum:j,dependencies:$.dependencies,stack:$.telemetry.stack,routes:$.router.history,decorators:$.singleton,store:$.singleton.store,type:$.definitions.type,error:$.definitions.error,derive:$.event.transform.filter((J)=>J?.subType==="derive").map((J)=>({fn:J.toString(),stack:new Error().stack??""})),resolve:$.event.transform.filter((J)=>J?.subType==="resolve").map((J)=>({fn:J.toString(),stack:new Error().stack??""}))}),this.event=A1(this.event,O1($.event),j)}else this.event=A1(this.event,O1($.event));return this.validator.global=l(this.validator.global,{...$.validator.global}),this.validator.local=l(this.validator.local,{...$.validator.scoped}),this}macro($){const W={checksum:P0(JSON.stringify({name:this.config.name,seed:this.config.seed,content:$.toString()})),fn:$};return this.extender.macros.push(W),this}mount($,W){if($ instanceof Z0||typeof $==="function"||$.length===0||$==="/"){const j=typeof $==="function"?$:$ instanceof Z0?$.compile().fetch:W instanceof Z0?W.compile().fetch:W,J=async({request:Q,path:Y})=>j(new Request($1(Q.url,Y||"/"),Q));return this.all("/*",J,{type:"none"}),this}const X=$.length;if(W instanceof Z0)W=W.compile().fetch;const Z=async({request:j,path:J})=>W(new Request($1(j.url,J.slice(X)||"/"),j));return this.all($,Z,{type:"none"}),this.all($+($.endsWith("/")?"*":"/*"),Z,{type:"none"}),this}get($,W,X){return this.add("GET",$,W,X),this}post($,W,X){return this.add("POST",$,W,X),this}put($,W,X){return this.add("PUT",$,W,X),this}patch($,W,X){return this.add("PATCH",$,W,X),this}delete($,W,X){return this.add("DELETE",$,W,X),this}options($,W,X){return this.add("OPTIONS",$,W,X),this}all($,W,X){return this.add("ALL",$,W,X),this}head($,W,X){return this.add("HEAD",$,W,X),this}connect($,W,X){return this.add("CONNECT",$,W,X),this}route($,W,X,Z){return this.add($.toUpperCase(),W,X,Z,Z?.config),this}ws($,W){const X=W.transformMessage?Array.isArray(W.transformMessage)?W.transformMessage:[W.transformMessage]:void 0;let Z=null;const j=m(W?.body,{models:this.definitions.type,normalize:this.config.normalize}),J=m(W?.response,{models:this.definitions.type,normalize:this.config.normalize}),Q=(Y)=>{if(typeof Y==="string"){const U=Y?.charCodeAt(0);if(U===47||U===123)try{Y=JSON.parse(Y)}catch{}else if(J1(Y))Y=+Y}if(X?.length)for(let U=0;U<X.length;U++){const B=X[U](Y);if(B!==void 0)Y=B}return Y};return this.route("$INTERNALWS",$,(Y)=>{const{set:U,path:B,qi:K,headers:w,query:F,params:G}=Y;if(Z===null)Z=this.getServer();if(Z?.upgrade(Y.request,{headers:typeof W.upgrade==="function"?W.upgrade(Y):W.upgrade,data:{validator:J,open(M){W.open?.(new g0(M,Y))},message:(M,D)=>{const z=Q(D);if(j?.Check(z)===!1)return void M.send(new T("message",j,z).message);W.message?.(new g0(M,Y),z)},drain(M){W.drain?.(new g0(M,Y))},close(M,D,z){W.close?.(new g0(M,Y),D,z)}}}))return;return U.status=400,"Expected a websocket connection"},{beforeHandle:W.beforeHandle,transform:W.transform,headers:W.headers,params:W.params,query:W.query}),this}state($,W,X){if(W===void 0)X=$,$={as:"append"},W="";else if(X===void 0){if(typeof $==="string")X=W,W=$,$={as:"append"};else if(typeof $==="object")X=W,W=""}const{as:Z}=$;if(typeof W!=="string")return this;switch(typeof X){case"object":if(W){if(W in this.singleton.store)this.singleton.store[W]=c(this.singleton.store[W],X,{override:Z==="override"});else this.singleton.store[W]=X;return this}if(X===null)return this;return this.singleton.store=c(this.singleton.store,X,{override:Z==="override"}),this;case"function":if(W){if(Z==="override"||!(W in this.singleton.store))this.singleton.store[W]=X}else this.singleton.store=X(this.singleton.store);return this;default:if(Z==="override"||!(W in this.singleton.store))this.singleton.store[W]=X;return this}}decorate($,W,X){if(W===void 0)X=$,$={as:"append"},W="";else if(X===void 0){if(typeof $==="string")X=W,W=$,$={as:"append"};else if(typeof $==="object")X=W,W=""}const{as:Z}=$;if(typeof W!=="string")return this;switch(typeof X){case"object":if(W){if(W in this.singleton.decorator)this.singleton.decorator[W]=c(this.singleton.decorator[W],X,{override:Z==="override"});else this.singleton.decorator[W]=X;return this}if(X===null)return this;return this.singleton.decorator=c(this.singleton.decorator,X,{override:Z==="override"}),this;case"function":if(W){if(Z==="override"||!(W in this.singleton.decorator))this.singleton.decorator[W]=X}else this.singleton.decorator=X(this.singleton.decorator);return this;default:if(Z==="override"||!(W in this.singleton.decorator))this.singleton.decorator[W]=X;return this}}derive($,W){if(!W)W=$,$={as:"local"};const X={subType:"derive",fn:W};return this.onTransform($,X)}model($,W){switch(typeof $){case"object":return Object.entries($).forEach(([X,Z])=>{if(!(X in this.definitions.type))this.definitions.type[X]=Z}),this;case"function":return this.definitions.type=$(this.definitions.type),this}return this.definitions.type[$]=W,this}mapDerive($,W){if(!W)W=$,$={as:"local"};const X={subType:"mapDerive",fn:W};return this.onTransform($,X)}affix($,W,X){if(X==="")return this;const Z=["_","-"," "],j=(U)=>U[0].toUpperCase()+U.slice(1),J=$==="prefix"?(U,B)=>Z.includes(U.at(-1)??"")?U+B:U+j(B):Z.includes(X.at(-1)??"")?(U,B)=>B+U:(U,B)=>B+j(U),Q=(U)=>{const B={};switch(U){case"decorator":for(let K in this.singleton.decorator)B[J(X,K)]=this.singleton.decorator[K];this.singleton.decorator=B;break;case"state":for(let K in this.singleton.store)B[J(X,K)]=this.singleton.store[K];this.singleton.store=B;break;case"model":for(let K in this.definitions.type)B[J(X,K)]=this.definitions.type[K];this.definitions.type=B;break;case"error":for(let K in this.definitions.error)B[J(X,K)]=this.definitions.error[K];this.definitions.error=B;break}},Y=Array.isArray(W)?W:[W];for(let U of Y.some((B)=>B==="all")?["decorator","state","model","error"]:Y)Q(U);return this}prefix($,W){return this.affix("prefix",$,W)}suffix($,W){return this.affix("suffix",$,W)}compile(){if(this.fetch=this.config.aot?R1(this):x1(this),typeof this.server?.reload==="function")this.server.reload({...this.server||{},fetch:this.fetch});return this}handle=async($)=>this.fetch($);fetch=($)=>{return(this.fetch=this.config.aot?R1(this):x1(this))($)};handleError=async($,W)=>(this.handleError=this.config.aot?b1(this):N2(this))($,W);outerErrorHandler=($)=>new Response($.message||$.name||"Error",{status:$?.status??500});listen=($,W)=>{if(typeof Bun==="undefined")throw new Error(".listen() is designed to run on Bun only. If you are running Elysia in other environment please use a dedicated plugin or export the handler via Elysia.fetch");if(this.compile(),typeof $==="string"){if(!J1($))throw new Error("Port must be a numeric value");$=parseInt($)}const X=this.fetch,Z=typeof $==="object"?{development:!l0,reusePort:!0,...this.config.serve||{},...$||{},websocket:{...this.config.websocket||{},...q1||{}},fetch:X,error:this.outerErrorHandler}:{development:!l0,reusePort:!0,...this.config.serve||{},websocket:{...this.config.websocket||{},...q1||{}},port:$,fetch:X,error:this.outerErrorHandler};this.server=Bun?.serve(Z);for(let j=0;j<this.event.start.length;j++)this.event.start[j].fn(this);if(W)W(this.server);return process.on("beforeExit",()=>{if(this.server){this.server.stop(),this.server=null;for(let j=0;j<this.event.stop.length;j++)this.event.stop[j].fn(this)}}),this.promisedModules.then(()=>{Bun?.gc(!1)}),this};stop=async()=>{if(!this.server)throw new Error("Elysia isn't running. Call `app.listen` to start the server.");if(this.server){if(this.server.stop(),this.server=null,this.event.stop.length)for(let $=0;$<this.event.stop.length;$++)this.event.stop[$].fn(this)}};get modules(){return Promise.all(this.promisedModules.promises)}}export{O as t,$1 as replaceUrlPath,Y2 as replaceSchemaType,d0 as redirect,x as mergeObjectArray,l as mergeHook,r as mapValueError,f as mapResponse,y as mapEarlyResponse,$0 as mapCompactResponse,m as getSchemaValidator,W1 as getResponseSchemaValidator,N0 as form,L1 as error,Z0 as default,Q1 as deduplicateChecksum,m0 as cloneInference,P0 as checksum,T as ValidationError,w0 as StatusMap,Y1 as ParseError,A0 as NotFoundError,Z1 as InvertedStatusMap,v0 as InvalidCookieSignature,G1 as InternalServerError,Z0 as Elysia,V0 as ERROR_CODE,i0 as ELYSIA_TRACE,d as ELYSIA_RESPONSE,I0 as ELYSIA_REQUEST_ID,P3 as ELYSIA_FORM_DATA,K0 as Cookie};

//# debugId=5362F721C857221F64756E2164756E21
